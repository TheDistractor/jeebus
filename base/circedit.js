(function() {
  var findPin, ng, prepareData;

  ng = angular.module('myApp');

  ng.directive('circuitEditor', function() {
    return {
      restrict: 'E',
      scope: {
        defs: '=',
        data: '='
      },
      link: function(scope, elem, attr) {
        var diag, g, gadgetDrag, gadgets, p, pins, svg, wires;
        prepareData(scope.defs, scope.data);
        svg = d3.select(elem[0]).append('svg').attr({
          height: "60%"
        });
        gadgets = svg.selectAll('.gadget').data(scope.data.gadgets);
        wires = svg.selectAll('.wire').data(scope.data.wires);
        diag = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        gadgetDrag = d3.behavior.drag().origin(Object).on('dragstart', function(d) {
          return this.parentNode.appendChild(this);
        }).on('drag', function(d) {
          d.x = d3.event.x | 0;
          d.y = d3.event.y | 0;
          d3.select(this).attr({
            transform: function(d) {
              return "translate(" + d.x + "," + d.y + ")";
            }
          });
          return wires.filter(function(w) {
            return w.source.g === d || w.target.g === d;
          }).each(function(d) {
            d.source = findPin(d.from, scope.data.gadgets);
            return d.target = findPin(d.to, scope.data.gadgets);
          }).attr({
            d: diag
          });
        }).on('dragend', function(d) {
          return console.log('save gadget', d);
        });
        g = gadgets.enter().append('g').call(gadgetDrag).attr({
          "class": 'gadget'
        });
        g.append('rect').each(function(d) {
          return d3.select(this).attr({
            "class": 'outline',
            x: 0.5 - d.hw,
            y: 0.5 - d.hh,
            width: 2 * d.hw,
            height: 2 * d.hh
          });
        }).style({
          fill: function(d) {
            return d.def.shade;
          }
        });
        g.append('text').text(function(d) {
          return d.title;
        }).attr({
          "class": 'title',
          y: function(d) {
            return 12 - d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.def.name;
        }).attr({
          "class": 'type',
          y: function(d) {
            return -4 + d.hh;
          }
        });
        g.append('text').text(function(d) {
          return d.def.icon;
        }).attr({
          "class": 'iconfont',
          x: 0,
          y: 0
        });
        pins = gadgets.selectAll('rect .pin').data(function(d) {
          return d.def.pins;
        });
        p = pins.enter();
        p.append('circle').attr({
          "class": 'pin',
          cx: (function(d) {
            return d.x + .5;
          }),
          cy: (function(d) {
            return d.y + .5;
          }),
          r: 3
        }).on('mousedown', function(d) {
          return console.log('c1', d);
        });
        p.append('text').text(function(d) {
          return d.name;
        }).attr({
          "class": function(d) {
            return d.dir;
          },
          x: function(d) {
            if (d.dir === 'in') {
              return d.x + 7;
            } else {
              return d.x - 7;
            }
          },
          y: function(d) {
            return d.y + 5;
          }
        });
        wires.enter().insert('path', 'g').attr({
          "class": 'wire',
          d: diag
        });
        return gadgets.attr({
          transform: function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          }
        });
      }
    };
  });

  findPin = function(name, gdata) {
    var g, gid, p, pname, _i, _j, _len, _len1, _ref, _ref1;
    _ref = name.split('.'), gid = _ref[0], pname = _ref[1];
    for (_i = 0, _len = gdata.length; _i < _len; _i++) {
      g = gdata[_i];
      if (gid === g.id) {
        _ref1 = g.def.pins;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          p = _ref1[_j];
          if (pname === p.name) {
            return {
              y: g.x + p.x + .5,
              x: g.y + p.y + .5,
              g: g,
              p: p
            };
          }
        }
      }
    }
  };

  prepareData = function(gdefs, gdata) {
    var d, ins, n, outs, p, step, yIn, yOut, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref, _ref1, _ref2, _ref3, _results;
    for (n in gdefs) {
      d = gdefs[n];
      d.name || (d.name = n);
      ins = 0;
      _ref = d.pins;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        p = _ref[_i];
        p.x = d.width / 2;
        if (p.dir === 'in') {
          p.x = -p.x;
          ++ins;
        }
      }
      outs = d.pins.length - ins;
      step = 16;
      yIn = -(ins - 1) * step / 2;
      yOut = -(outs - 1) * step / 2;
      _ref1 = d.pins;
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        p = _ref1[_j];
        if (p.dir === 'in') {
          p.y = yIn;
          yIn += step;
        } else {
          p.y = yOut;
          yOut += step;
        }
      }
      d.height = 30 + step * (ins > outs ? ins : outs);
    }
    _ref2 = gdata.gadgets;
    for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
      d = _ref2[_k];
      d.def = gdefs[d.type];
      d.hw = d.def.width / 2;
      d.hh = d.def.height / 2;
    }
    _ref3 = gdata.wires;
    _results = [];
    for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {
      d = _ref3[_l];
      d.source = findPin(d.from, gdata.gadgets);
      _results.push(d.target = findPin(d.to, gdata.gadgets));
    }
    return _results;
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2lyY2VkaXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQSx3QkFBQTs7QUFBQSxFQUFBLEVBQUEsR0FBSyxPQUFPLENBQUMsTUFBUixDQUFlLE9BQWYsQ0FBTCxDQUFBOztBQUFBLEVBRUEsRUFBRSxDQUFDLFNBQUgsQ0FBYSxlQUFiLEVBQThCLFNBQUEsR0FBQTtXQUM1QjtBQUFBLE1BQUEsUUFBQSxFQUFVLEdBQVY7QUFBQSxNQUVBLEtBQUEsRUFDRTtBQUFBLFFBQUEsSUFBQSxFQUFNLEdBQU47QUFBQSxRQUNBLElBQUEsRUFBTSxHQUROO09BSEY7QUFBQSxNQU1BLElBQUEsRUFBTSxTQUFDLEtBQUQsRUFBUSxJQUFSLEVBQWMsSUFBZCxHQUFBO0FBQ0osWUFBQSxpREFBQTtBQUFBLFFBQUEsV0FBQSxDQUFZLEtBQUssQ0FBQyxJQUFsQixFQUF3QixLQUFLLENBQUMsSUFBOUIsQ0FBQSxDQUFBO0FBQUEsUUFFQSxHQUFBLEdBQU0sRUFBRSxDQUFDLE1BQUgsQ0FBVSxJQUFLLENBQUEsQ0FBQSxDQUFmLENBQWtCLENBQUMsTUFBbkIsQ0FBMEIsS0FBMUIsQ0FDSixDQUFDLElBREcsQ0FDRTtBQUFBLFVBQUEsTUFBQSxFQUFRLEtBQVI7U0FERixDQUZOLENBQUE7QUFBQSxRQUlBLE9BQUEsR0FBVSxHQUFHLENBQUMsU0FBSixDQUFjLFNBQWQsQ0FBd0IsQ0FBQyxJQUF6QixDQUE4QixLQUFLLENBQUMsSUFBSSxDQUFDLE9BQXpDLENBSlYsQ0FBQTtBQUFBLFFBS0EsS0FBQSxHQUFRLEdBQUcsQ0FBQyxTQUFKLENBQWMsT0FBZCxDQUFzQixDQUFDLElBQXZCLENBQTRCLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBdkMsQ0FMUixDQUFBO0FBQUEsUUFPQSxJQUFBLEdBQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFQLENBQUEsQ0FDTCxDQUFDLFVBREksQ0FDTyxTQUFDLENB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QUFBQSxTQUFBLDhDQUFBO29CQUFBO0FBQ0UsTUFBQSxDQUFDLENBQUMsR0FBRixHQUFRLEtBQU0sQ0FBQSxDQUFDLENBQUMsSUFBRixDQUFkLENBQUE7QUFBQSxNQUNBLENBQUMsQ0FBQyxFQUFGLEdBQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFOLEdBQWMsQ0FEckIsQ0FBQTtBQUFBLE1BRUEsQ0FBQyxDQUFDLEVBQUYsR0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU4sR0FBZSxDQUZ0QixDQURGO0FBQUEsS0FyQkE7QUEwQkE7QUFBQTtTQUFBLDhDQUFBO29CQUFBO0FBQ0UsTUFBQSxDQUFDLENBQUMsTUFBRixHQUFXLE9BQUEsQ0FBUSxDQUFDLENBQUMsSUFBVixFQUFnQixLQUFLLENBQUMsT0FBdEIsQ0FBWCxDQUFBO0FBQUEsb0JBQ0EsQ0FBQyxDQUFDLE1BQUYsR0FBVyxPQUFBLENBQVEsQ0FBQyxDQUFDLEVBQVYsRUFBYyxLQUFLLENBQUMsT0FBcEIsRUFEWCxDQURGO0FBQUE7b0JBNUJZO0VBQUEsQ0E5RWQsQ0FBQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsibmcgPSBhbmd1bGFyLm1vZHVsZSAnbXlBcHAnXG5cbm5nLmRpcmVjdGl2ZSAnY2lyY3VpdEVkaXRvcicsIC0+XG4gIHJlc3RyaWN0OiAnRSdcbiAgXG4gIHNjb3BlOlxuICAgIGRlZnM6ICc9J1xuICAgIGRhdGE6ICc9J1xuICAgIFxuICBsaW5rOiAoc2NvcGUsIGVsZW0sIGF0dHIpIC0+XG4gICAgcHJlcGFyZURhdGEgc2NvcGUuZGVmcywgc2NvcGUuZGF0YVxuICAgIFxuICAgIHN2ZyA9IGQzLnNlbGVjdChlbGVtWzBdKS5hcHBlbmQgJ3N2ZydcbiAgICAgIC5hdHRyIGhlaWdodDogXCI2MCVcIlxuICAgIGdhZGdldHMgPSBzdmcuc2VsZWN0QWxsKCcuZ2FkZ2V0JykuZGF0YShzY29wZS5kYXRhLmdhZGdldHMpXG4gICAgd2lyZXMgPSBzdmcuc2VsZWN0QWxsKCcud2lyZScpLmRhdGEoc2NvcGUuZGF0YS53aXJlcylcblxuICAgIGRpYWcgPSBkMy5zdmcuZGlhZ29uYWwoKVxuICAgICAgLnByb2plY3Rpb24gKGQpIC0+IFtkLnksIGQueF0gIyB1bmRvIHRoZSB4L3kgcmV2ZXJzYWwgZnJvbSBmaW5kUGluXG4gICAgXG4gICAgZ2FkZ2V0RHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgLm9yaWdpbiBPYmplY3RcbiAgICAgIC5vbiAnZHJhZ3N0YXJ0JywgKGQpIC0+XG4gICAgICAgIEBwYXJlbnROb2RlLmFwcGVuZENoaWxkIEAgIyBtb3ZlIHRvIGZyb250XG4gICAgICAub24gJ2RyYWcnLCAoZCkgLT5cbiAgICAgICAgZC54ID0gZDMuZXZlbnQueCB8IDAgIyBzdGF5IG9uIGludCBjb29yZGluYXRlc1xuICAgICAgICBkLnkgPSBkMy5ldmVudC55IHwgMCAjIHN0YXkgb24gaW50IGNvb3JkaW5hdGVzXG4gICAgICAgIGQzLnNlbGVjdChAKS5hdHRyIHRyYW5zZm9ybTogKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC54fSwje2QueX0pXCJcbiAgICAgICAgIyByZWNhbGN1bGF0ZSBlbmRwb2ludHMgYW5kIHJlZHJhdyBhbGwgd2lyZXMgYXR0YWNoZWQgdG8gdGhpcyBnYWRnZXRcbiAgICAgICAgd2lyZXMuZmlsdGVyICh3KSAtPiB3LnNvdXJjZS5nIGlzIGQgb3Igdy50YXJnZXQuZyBpcyBkXG4gICAgICAgICAgLmVhY2ggKGQpIC0+XG4gICAgICAgICAgICBkLnNvdXJjZSA9IGZpbmRQaW4gZC5mcm9tLCBzY29wZS5kYXRhLmdhZGdldHNcbiAgICAgICAgICAgIGQudGFyZ2V0ID0gZmluZFBpbiBkLnRvLCBzY29wZS5kYXRhLmdhZGdldHNcbiAgICAgICAgICAuYXR0ciBkOiBkaWFnXG4gICAgICAub24gJ2RyYWdlbmQnLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ3NhdmUgZ2FkZ2V0JywgZCAjIFRPRE86IHNhdmUgdG8gc2VydmVyXG5cbiAgICBnID0gZ2FkZ2V0cy5lbnRlcigpLmFwcGVuZCgnZycpLmNhbGwoZ2FkZ2V0RHJhZylcbiAgICAgIC5hdHRyIGNsYXNzOiAnZ2FkZ2V0J1xuICAgIGcuYXBwZW5kKCdyZWN0JylcbiAgICAgIC5lYWNoIChkKSAtPlxuICAgICAgICBkMy5zZWxlY3QoQCkuYXR0clxuICAgICAgICAgIGNsYXNzOiAnb3V0bGluZSdcbiAgICAgICAgICAjIDFweCBsaW5lcyByZW5kZXIgc2hhcnBseSB3aGVuIG9uIGEgMC41cHggb2Zmc2V0XG4gICAgICAgICAgeDogMC41IC0gZC5odywgeTogMC41IC0gZC5oaFxuICAgICAgICAgIHdpZHRoOiAyICogZC5odywgaGVpZ2h0OiAyICogZC5oaFxuICAgICAgLnN0eWxlIGZpbGw6IChkKSAtPiBkLmRlZi5zaGFkZVxuICAgIGcuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC50aXRsZVxuICAgICAgLmF0dHIgY2xhc3M6ICd0aXRsZScsIHk6IChkKSAtPiAxMiAtIGQuaGhcbiAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQuZGVmLm5hbWVcbiAgICAgIC5hdHRyIGNsYXNzOiAndHlwZScsIHk6IChkKSAtPiAtNCArIGQuaGhcbiAgICBnLmFwcGVuZCgndGV4dCcpLnRleHQgKGQpIC0+IGQuZGVmLmljb25cbiAgICAgIC5hdHRyIGNsYXNzOiAnaWNvbmZvbnQnLCB4OiAwLCB5OiAwXG4gICAgICAgIFxuICAgIHBpbnMgPSBnYWRnZXRzLnNlbGVjdEFsbCgncmVjdCAucGluJykuZGF0YSAoZCkgLT4gZC5kZWYucGluc1xuICAgIHAgPSBwaW5zLmVudGVyKClcbiAgICBwLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgIC5hdHRyIGNsYXNzOiAncGluJywgY3g6ICgoZCkgLT4gZC54Ky41KSwgY3k6ICgoZCkgLT4gZC55Ky41KSwgcjogM1xuICAgICAgLm9uICdtb3VzZWRvd24nLCAoZCkgLT5cbiAgICAgICAgY29uc29sZS5sb2cgJ2MxJywgZFxuICAgIHAuYXBwZW5kKCd0ZXh0JykudGV4dCAoZCkgLT4gZC5uYW1lXG4gICAgICAuYXR0clxuICAgICAgICBjbGFzczogKGQpIC0+IGQuZGlyXG4gICAgICAgIHg6IChkKSAtPiBpZiBkLmRpciBpcyAnaW4nIHRoZW4gZC54ICsgNyBlbHNlIGQueCAtIDdcbiAgICAgICAgeTogKGQpIC0+IGQueSArIDVcblxuICAgIHdpcmVzLmVudGVyKCkuaW5zZXJ0KCdwYXRoJywgJ2cnKSAjIHVzZXMgaW5zZXJ0IHRvIG1vdmUgdG8gYmFjayByaWdodCBhd2F5XG4gICAgICAuYXR0ciBjbGFzczogJ3dpcmUnLCBkOiBkaWFnXG5cbiAgICBnYWRnZXRzLmF0dHIgdHJhbnNmb3JtOiAoZCkgLT4gXCJ0cmFuc2xhdGUoI3tkLnh9LCN7ZC55fSlcIlxuXG5maW5kUGluID0gKG5hbWUsIGdkYXRhKSAtPlxuICBbZ2lkLHBuYW1lXSA9IG5hbWUuc3BsaXQgJy4nXG4gIGZvciBnIGluIGdkYXRhIHdoZW4gZ2lkIGlzIGcuaWRcbiAgICBmb3IgcCBpbiBnLmRlZi5waW5zIHdoZW4gcG5hbWUgaXMgcC5uYW1lXG4gICAgICAjIHJldmVyc2VzIHggYW5kIHkgYW5kIHVzZXMgcHJvamVjdGlvbiB0byBnZXQgaG9yaXpvbnRhbCBzcGxpbmVzXG4gICAgICByZXR1cm4geTogZy54ICsgcC54ICsgLjUsIHg6IGcueSArIHAueSArIC41LCBnOiBnLCBwOiBwXG5cbnByZXBhcmVEYXRhID0gKGdkZWZzLCBnZGF0YSkgLT5cbiAgIyBwcmUtY2FsY3VsYXRlIHNpemVzIGFuZCByZWxhdGl2ZSBwaW4gY29vcmRpbmF0ZXNcbiAgZm9yIG4sIGQgb2YgZ2RlZnNcbiAgICBkLm5hbWUgb3I9IG5cbiAgICBpbnMgPSAwXG4gICAgZm9yIHAgaW4gZC5waW5zXG4gICAgICBwLnggPSBkLndpZHRoIC8gMlxuICAgICAgaWYgcC5kaXIgaXMgJ2luJ1xuICAgICAgICBwLnggPSAtcC54XG4gICAgICAgICsraW5zXG4gICAgb3V0cyA9IGQucGlucy5sZW5ndGggLSBpbnNcbiAgICBzdGVwID0gMTZcbiAgICB5SW4gPSAtIChpbnMgLSAxKSAqIHN0ZXAgLyAyXG4gICAgeU91dCA9IC0gKG91dHMgLSAxKSAqIHN0ZXAgLyAyXG4gICAgZm9yIHAgaW4gZC5waW5zXG4gICAgICBpZiBwLmRpciBpcyAnaW4nXG4gICAgICAgIHAueSA9IHlJblxuICAgICAgICB5SW4gKz0gc3RlcFxuICAgICAgZWxzZVxuICAgICAgICBwLnkgPSB5T3V0XG4gICAgICAgIHlPdXQgKz0gc3RlcFxuICAgIGQuaGVpZ2h0ID0gMzAgKyBzdGVwICogKGlmIGlucyA+IG91dHMgdGhlbiBpbnMgZWxzZSBvdXRzKVxuXG4gIGZvciBkIGluIGdkYXRhLmdhZGdldHNcbiAgICBkLmRlZiA9IGdkZWZzW2QudHlwZV1cbiAgICBkLmh3ID0gZC5kZWYud2lkdGggLyAyXG4gICAgZC5oaCA9IGQuZGVmLmhlaWdodCAvIDJcblxuICBmb3IgZCBpbiBnZGF0YS53aXJlc1xuICAgIGQuc291cmNlID0gZmluZFBpbiBkLmZyb20sIGdkYXRhLmdhZGdldHNcbiAgICBkLnRhcmdldCA9IGZpbmRQaW4gZC50bywgZ2RhdGEuZ2FkZ2V0c1xuIl19
