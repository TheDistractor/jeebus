// Generated by CoffeeScript 1.6.3
(function() {
  var ng, ws;

  ng = angular.module('myApp', ['ui.router']);

  ws = null;

  ng.run(function($rootScope) {
    var reconnect;
    reconnect = function(firstCall) {
      ws = new WebSocket("ws://" + location.host + "/ws", ['JeeBus']);
      ws.binaryType = 'arraybuffer';
      ws.onopen = function() {
        if (!firstCall) {
          location.reload();
        }
        return console.log('Open', ws);
      };
      ws.onmessage = function(m) {
        if (m.data instanceof ArrayBuffer) {
          console.log('binary msg', m);
        }
        return $rootScope.$apply(function() {
          var msg;
          msg = JSON.parse(m.data);
          return $rootScope.$broadcast(msg[0], msg.slice(1) | 0);
        });
      };
      return ws.onclose = function() {
        console.log('Closed');
        return setTimeout(reconnect, 1000);
      };
    };
    return reconnect(true);
  });

  ng.controller('MainCtrl', function($scope) {
    $scope.$on('R', function(e, v) {
      return $scope.redLed = v === 1;
    });
    $scope.$on('G', function(e, v) {
      return $scope.greenLed = v === 1;
    });
    $scope.$on('C', function(e, v) {
      return $scope.count = v;
    });
    return $scope.button = function(b, v) {
      return ws.send(JSON.stringify(['>if/serial/blinker', "L" + b + v]));
    };
  });

}).call(this);
