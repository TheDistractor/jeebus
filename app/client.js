// Generated by CoffeeScript 1.6.3
(function() {
  var ng, ws;

  ng = angular.module('myApp', ['ui.router']);

  ws = null;

  ng.run(function($rootScope) {
    var reconnect, setCount;
    setCount = function(data) {
      return $rootScope.$apply(function() {
        return $rootScope.count = data;
      });
    };
    reconnect = function(firstCall) {
      ws = new WebSocket("ws://" + location.host + "/ws");
      ws.onopen = function() {
        if (!firstCall) {
          location.reload();
        }
        return console.log('Open');
      };
      ws.onmessage = function(m) {
        return $rootScope.$apply(function() {
          var msg;
          msg = JSON.parse(m.data);
          return $rootScope.$broadcast(msg[0], msg.slice(1) | 0);
        });
      };
      return ws.onclose = function() {
        console.log('Closed');
        return setTimeout(reconnect, 1000);
      };
    };
    return reconnect(true);
  });

  ng.controller('MainCtrl', function($scope) {
    $scope.$on('R', function(e, v) {
      return $scope.redLed = v !== 0;
    });
    $scope.$on('G', function(e, v) {
      return $scope.greenLed = v !== 0;
    });
    $scope.$on('C', function(e, v) {
      return $scope.count = v;
    });
    return $scope.button = function(b, v) {
      return ws.send(JSON.stringify([b, v]));
    };
  });

}).call(this);
