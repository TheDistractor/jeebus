(function() {
  var ng;

  ng = angular.module('myApp');

  ng.config(function($stateProvider, navbarProvider) {
    $stateProvider.state('status', {
      url: '/status',
      templateUrl: 'status/status.html',
      controller: 'StatusCtrl'
    });
    return navbarProvider.add('/status', 'Status', 30);
  });

  ng.controller('StatusCtrl', function($scope, jeebus) {
    var attach, readingMap, readingVec, unitMap, unitVec, update;
    readingVec = $scope.readings = [];
    readingMap = {};
    unitVec = $scope.units = [];
    unitMap = {};
    attach = function() {
      jeebus.gadget('Attach', {
        In: '/sensor/'
      }).on('Out', function(msg) {
        var dev, did, key, loc, ms, raw, tid, typ, val, _ref, _results;
        dev = msg.Tag, (_ref = msg.Msg, loc = _ref.loc, ms = _ref.ms, val = _ref.val, typ = _ref.typ);
        if (dev === '<range>') {
          return;
        }
        _results = [];
        for (key in val) {
          raw = val[key];
          did = "" + (dev.slice(8)) + " - " + key;
          tid = "" + typ + "/" + key;
          if (readingMap[did] == null) {
            readingMap[did] = readingVec.length;
          }
          _results.push(readingVec[readingMap[did]] = update({
            loc: loc,
            key: key,
            raw: raw,
            ms: ms,
            typ: typ,
            did: did,
            tid: tid
          }));
        }
        return _results;
      });
      return jeebus.gadget('Attach', {
        In: '/driver/'
      }).on('Out', function(msg) {
        var info, row, tag, tid, _i, _len, _results;
        tag = msg.Tag, info = msg.Msg;
        if (tag === '<range>') {
          return;
        }
        tid = tag.slice(8);
        if (unitMap[tid] == null) {
          unitMap[tid] = unitVec.length;
        }
        unitVec[unitMap[tid]] = info;
        _results = [];
        for (_i = 0, _len = readingVec.length; _i < _len; _i++) {
          row = readingVec[_i];
          _results.push(update(row));
        }
        return _results;
      });
    };
    update = function(row) {
      var info;
      info = unitVec[unitMap[row.tid]];
      row.value = row.raw;
      if (info != null) {
        row.key = info.name;
        row.unit = info.unit;
        if (info.factor) {
          row.value *= info.factor;
        }
        if (info.scale < 0) {
          row.value *= Math.pow(10, -info.scale);
        } else if (info.scale >= 0) {
          row.value /= Math.pow(10, info.scale);
          row.value = row.value.toFixed(info.scale);
        }
      }
      return row;
    };
    if ($scope.serverStatus === 'connected') {
      attach();
    }
    return $scope.$on('ws-open', function() {
      return attach();
    });
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3RhdHVzLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUEsRUFBQTs7QUFBQSxFQUFBLEVBQUEsR0FBSyxPQUFPLENBQUMsTUFBUixDQUFlLE9BQWYsQ0FBTCxDQUFBOztBQUFBLEVBRUEsRUFBRSxDQUFDLE1BQUgsQ0FBVSxTQUFDLGNBQUQsRUFBaUIsY0FBakIsR0FBQTtBQUNSLElBQUEsY0FBYyxDQUFDLEtBQWYsQ0FBcUIsUUFBckIsRUFDRTtBQUFBLE1BQUEsR0FBQSxFQUFLLFNBQUw7QUFBQSxNQUNBLFdBQUEsRUFBYSxvQkFEYjtBQUFBLE1BRUEsVUFBQSxFQUFZLFlBRlo7S0FERixDQUFBLENBQUE7V0FJQSxjQUFjLENBQUMsR0FBZixDQUFtQixTQUFuQixFQUE4QixRQUE5QixFQUF3QyxFQUF4QyxFQUxRO0VBQUEsQ0FBVixDQUZBLENBQUE7O0FBQUEsRUFTQSxFQUFFLENBQUMsVUFBSCxDQUFjLFlBQWQsRUFBNEIsU0FBQyxNQUFELEVBQVMsTUFBVCxHQUFBO0FBQzFCLFFBQUEsd0RBQUE7QUFBQSxJQUFBLFVBQUEsR0FBYSxNQUFNLENBQUMsUUFBUCxHQUFrQixFQUEvQixDQUFBO0FBQUEsSUFDQSxVQUFBLEdBQWEsRUFEYixDQUFBO0FBQUEsSUFFQSxPQUFBLEdBQVUsTUFBTSxDQUFDLEtBQVAsR0FBZSxFQUZ6QixDQUFBO0FBQUEsSUFHQSxPQUFBLEdBQVUsRUFIVixDQUFBO0FBQUEsSUFLQSxNQUFBLEdBQVMsU0FBQSxHQUFBO0FBQ1AsTUFBQSxNQUFNLENBQUMsTUFBUCxDQUFjLFFBQWQsRUFBd0I7QUFBQSxRQUFBLEVBQUEsRUFBSSxVQUFKO09BQXhCLENBQ0UsQ0FBQyxFQURILENBQ00sS0FETixFQUNhLFNBQUMsR0FBRCxHQUFBO0FBRVQsWUFBQSwwREFBQTtBQUFBLFFBQUssVUFBSixHQUFELGNBQVMsS0FBSyxXQUFBLEtBQUksVUFBQSxJQUFHLFdBQUEsS0FBSSxXQUFBLElBQXpCLENBQUE7QUFDQSxRQUFBLElBQVcsR0FBQSxLQUFPLFNBQWxCO0FBQUEsZ0JBQUEsQ0FBQTtTQURBO0FBRUE7YUFBQSxVQUFBO3lCQUFBO0FBQ0UsVUFBQSxHQUFBLEdBQU0sRUFBQSxHQUFFLENBQUEsR0FBRyxDQUFDLEtBQUosQ0FBVSxDQUFWLENBQUEsQ0FBRixHQUFnQixLQUFoQixHQUFvQixHQUExQixDQUFBO0FBQUEsVUFDQSxHQUFBLEdBQU0sRUFBQSxHQUFFLEdBQUYsR0FBTyxHQUFQLEdBQVMsR0FEZixDQUFBOztZQUVBLFVBQVcsQ0FBQSxHQUFBLElBQVEsVUFBVSxDQUFDO1dBRjlCO0FBQUEsd0JBR0EsVUFBVyxDQUFBLFVBQVcsQ0FBQSxHQUFBLENBQVgsQ0FBWCxHQUE4QixNQUFBLENBQU87QUFBQSxZQUFDLEtBQUEsR0FBRDtBQUFBLFlBQUssS0FBQSxHQUFMO0FBQUEsWUFBUyxLQUFBLEdBQVQ7QUFBQSxZQUFhLElBQUEsRUFBYjtBQUFBLFlBQWdCLEtBQUEsR0FBaEI7QUFBQSxZQUFvQixLQUFBLEdBQXBCO0FBQUEsWUFBd0IsS0FBQSxHQUF4QjtXQUFQLEVBSDlCLENBREY7QUFBQTt3QkFKUztNQUFBLENBRGIsQ0FBQSxDQUFBO2FBV0EsTUFBTSxDQUFDLE1BQVAsQ0FBYyxRQUFkLEVBQXdCO0FBQUEsUUFBQSxFQUFBLEVBQUksVUFBSjtPQUF4QixDQUNFLENBQUMsRUFESCxDQUNNLEtBRE4sRUFDYSxTQUFDLEdBQUQsR0FBQTtBQUVULFlBQUEsdUNBQUE7QUFBQSxRQUFLLFVBQUosR0FBRCxFQUFhLFdBQUosR0FBVCxDQUFBO0FBQ0EsUUFBQSxJQUFXLEdBQUEsS0FBTyxTQUFsQjtBQUFBLGdCQUFBLENBQUE7U0FEQTtBQUFBLFFBRUEsR0FBQSxHQUFNLEdBQUcsQ0FBQyxLQUFKLENBQVUsQ0FBVixDQUZOLENBQUE7O1VBR0EsT0FBUSxDQUFBLEdBQUEsSUFBUSxPQUFPLENBQUM7U0FIeEI7QUFBQSxRQUlBLE9BQVEsQ0FBQSxPQUFRLENBQUEsR0FBQSxDQUFSLENBQVIsR0FBd0IsSUFKeEIsQ0FBQTtBQU1BO2FBQUEsaURBQUE7K0JBQUE7QUFBQSx3QkFBQSxNQUFBLENBQU8sR0FBUCxFQUFBLENBQUE7QUFBQTt3QkFSUztNQUFBLENBRGIsRUFaTztJQUFBLENBTFQsQ0FBQTtBQUFBLElBNEJBLE1BQUEsR0FBUyxTQUFDLEdBQUQsR0FBQTtBQUNQLFVBQUEsSUFBQTtBQUFBLE1BQUEsSUFBQSxHQUFPLE9BQVEsQ0FBQSxPQUFRLENBQUEsR0FBRyxDQUFDLEdBQUosQ0FBUixDQUFmLENBQUE7QUFBQSxNQUNBLEdBQUcsQ0FBQyxLQUFKLEdBQVksR0FBRyxDQUFDLEdBRGhCLENBQUE7QUFFQSxNQUFBLElBQUcsWUFBSDtBQUNFLFFBQUEsR0FBRyxDQUFDLEdBQUosR0FBVSxJQUFJLENBQUMsSUFBZixDQUFBO0FBQUEsUUFDQSxHQUFHLENBQUMsSUFBSixHQUFXLElBQUksQ0FBQyxJQURoQixDQUFBO0FBR0EsUUFBQSxJQUFHLElBQUksQ0FBQyxNQUFSO0FBQ0UsVUFBQSxHQUFHLENBQUMsS0FBSixJQUFhLElBQUksQ0FBQyxNQUFsQixDQURGO1NBSEE7QUFLQSxRQUFBLElBQUcsSUFBSSxDQUFDLEtBQUwsR0FBYSxDQUFoQjtBQUNFLFVBQUEsR0FBRyxDQUFDLEtBQUosSUFBYSxJQUFJLENBQUMsR0FBTCxDQUFTLEVBQVQsRUFBYSxDQUFBLElBQUssQ0FBQyxLQUFuQixDQUFiLENBREY7U0FBQSxNQUVLLElBQUcsSUFBSSxDQUFDLEtBQUwsSUFBYyxDQUFqQjtBQUNILFVBQUEsR0FBRyxDQUFDLEtBQUosSUFBYSxJQUFJLENBQUMsR0FBTCxDQUFTLEVBQVQsRUFBYSxJQUFJLENBQUMsS0FBbEIsQ0FBYixDQUFBO0FBQUEsVUFDQSxHQUFHLENBQUMsS0FBSixHQUFZLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBVixDQUFrQixJQUFJLENBQUMsS0FBdkIsQ0FEWixDQURHO1NBUlA7T0FGQTthQWNBLElBZk87SUFBQSxDQTVCVCxDQUFBO0FBNkNBLElBQUEsSUFBYSxNQUFNLENBQUMsWUFBUCxLQUF1QixXQUFwQztBQUFBLE1BQUEsTUFBQSxDQUFBLENBQUEsQ0FBQTtLQTdDQTtXQThDQSxNQUFNLENBQUMsR0FBUCxDQUFXLFNBQVgsRUFBc0IsU0FBQSxHQUFBO2FBQUcsTUFBQSxDQUFBLEVBQUg7SUFBQSxDQUF0QixFQS9DMEI7RUFBQSxDQUE1QixDQVRBLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIm5nID0gYW5ndWxhci5tb2R1bGUgJ215QXBwJ1xuXG5uZy5jb25maWcgKCRzdGF0ZVByb3ZpZGVyLCBuYXZiYXJQcm92aWRlcikgLT5cbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUgJ3N0YXR1cycsXG4gICAgdXJsOiAnL3N0YXR1cydcbiAgICB0ZW1wbGF0ZVVybDogJ3N0YXR1cy9zdGF0dXMuaHRtbCdcbiAgICBjb250cm9sbGVyOiAnU3RhdHVzQ3RybCdcbiAgbmF2YmFyUHJvdmlkZXIuYWRkICcvc3RhdHVzJywgJ1N0YXR1cycsIDMwXG5cbm5nLmNvbnRyb2xsZXIgJ1N0YXR1c0N0cmwnLCAoJHNjb3BlLCBqZWVidXMpIC0+XG4gIHJlYWRpbmdWZWMgPSAkc2NvcGUucmVhZGluZ3MgPSBbXVxuICByZWFkaW5nTWFwID0ge31cbiAgdW5pdFZlYyA9ICRzY29wZS51bml0cyA9IFtdXG4gIHVuaXRNYXAgPSB7fVxuXG4gIGF0dGFjaCA9IC0+XG4gICAgamVlYnVzLmdhZGdldCAnQXR0YWNoJywgSW46ICcvc2Vuc29yLydcbiAgICAgIC5vbiAnT3V0JywgKG1zZykgLT5cbiAgICAgICAgIyBsb2M6IC4uLiB2YWw6IFtjMToxMixjMjozNCwuLi5dXG4gICAgICAgIHtUYWc6ZGV2LE1zZzp7bG9jLG1zLHZhbCx0eXB9fSA9IG1zZ1xuICAgICAgICByZXR1cm4gIGlmIGRldiBpcyAnPHJhbmdlPidcbiAgICAgICAgZm9yIGtleSwgcmF3IG9mIHZhbFxuICAgICAgICAgIGRpZCA9IFwiI3tkZXYuc2xpY2UoOCl9IC0gI3trZXl9XCIgIyBkZXZpY2UgaWRcbiAgICAgICAgICB0aWQgPSBcIiN7dHlwfS8je2tleX1cIiAgICAgICAgICAgICMgdHlwZSBpZFxuICAgICAgICAgIHJlYWRpbmdNYXBbZGlkXSA/PSByZWFkaW5nVmVjLmxlbmd0aFxuICAgICAgICAgIHJlYWRpbmdWZWNbcmVhZGluZ01hcFtkaWRdXSA9IHVwZGF0ZSB7bG9jLGtleSxyYXcsbXMsdHlwLGRpZCx0aWR9XG4gICAgICAgICAgXG4gICAgamVlYnVzLmdhZGdldCAnQXR0YWNoJywgSW46ICcvZHJpdmVyLydcbiAgICAgIC5vbiAnT3V0JywgKG1zZykgLT5cbiAgICAgICAgIyBuYW1lOiB1bml0OiBzY2FsZTogLi4uXG4gICAgICAgIHtUYWc6dGFnLE1zZzppbmZvfSA9IG1zZ1xuICAgICAgICByZXR1cm4gIGlmIHRhZyBpcyAnPHJhbmdlPidcbiAgICAgICAgdGlkID0gdGFnLnNsaWNlKDgpXG4gICAgICAgIHVuaXRNYXBbdGlkXSA/PSB1bml0VmVjLmxlbmd0aFxuICAgICAgICB1bml0VmVjW3VuaXRNYXBbdGlkXV0gPSBpbmZvXG4gICAgICAgICMgdXBkYXRlIGV4aXN0aW5nIHJlYWRpbmdzXG4gICAgICAgIHVwZGF0ZSByb3cgIGZvciByb3cgaW4gcmVhZGluZ1ZlY1xuXG4gIHVwZGF0ZSA9IChyb3cpIC0+XG4gICAgaW5mbyA9IHVuaXRWZWNbdW5pdE1hcFtyb3cudGlkXV1cbiAgICByb3cudmFsdWUgPSByb3cucmF3XG4gICAgaWYgaW5mbz9cbiAgICAgIHJvdy5rZXkgPSBpbmZvLm5hbWVcbiAgICAgIHJvdy51bml0ID0gaW5mby51bml0XG5cbiAgICAgIGlmIGluZm8uZmFjdG9yXG4gICAgICAgIHJvdy52YWx1ZSAqPSBpbmZvLmZhY3RvclxuICAgICAgaWYgaW5mby5zY2FsZSA8IDBcbiAgICAgICAgcm93LnZhbHVlICo9IE1hdGgucG93IDEwLCAtaW5mby5zY2FsZVxuICAgICAgZWxzZSBpZiBpbmZvLnNjYWxlID49IDBcbiAgICAgICAgcm93LnZhbHVlIC89IE1hdGgucG93IDEwLCBpbmZvLnNjYWxlXG4gICAgICAgIHJvdy52YWx1ZSA9IHJvdy52YWx1ZS50b0ZpeGVkIGluZm8uc2NhbGVcblxuICAgIHJvd1xuXG4gIGF0dGFjaCgpICBpZiAkc2NvcGUuc2VydmVyU3RhdHVzIGlzICdjb25uZWN0ZWQnXG4gICRzY29wZS4kb24gJ3dzLW9wZW4nLCAtPiBhdHRhY2goKVxuIl19
