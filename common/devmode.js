(function() {
  var coffee, compileCoffeeScriptWithMap, compileIfNeeded, convert, createWatcher, fatal, fs, jade, main, moduleDir, parseSettings, path, pid, recompileGoFiles, runMain, settings, spawn, stylus, traverseDirs, watchDir;

  fs = require('fs');

  path = require('path');

  spawn = require('child_process').spawn;

  moduleDir = function(s) {
    return path.resolve('node_modules', s);
  };

  coffee = require(moduleDir('coffee-script'));

  convert = require(moduleDir('convert-source-map'));

  jade = require(moduleDir('jade'));

  stylus = require(moduleDir('stylus'));

  fatal = function(s) {
    console.error('\n[node] fatal error:', s);
    return process.exit(1);
  };

  main = void 0;

  pid = void 0;

  runMain = function() {
    var args, f, _i, _len, _ref;
    args = ['run'];
    _ref = fs.readdirSync('.');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      f = _ref[_i];
      if (/\.go$/i.test(f) && !/_test\./i.test(f)) {
        args.push(f);
        fs.watch(f, recompileGoFiles);
      }
    }
    console.log('[node] go', args.join(' '));
    main = spawn('go', args, {
      stdio: ['ipc', process.stdout, process.stderr]
    });
    main.on('error', function(err) {
      return fatal('cannot launch "go"');
    });
    main.on('message', function(msg) {
      console.log('[node] pid message:', msg);
      return pid = msg | 0;
    });
    main.on('close', function(code) {
      if (code > 0) {
        return fatal('unexpected termination of "main", code: ' + code);
      }
    });
    return main.on('exit', function() {
      return fatal('main exited');
    });
  };

  recompileGoFiles = function() {
    if (pid > 0) {
      main.removeAllListeners();
      process.kill(pid, 'SIGHUP');
      pid = 0;
      return runMain();
    }
  };

  compileCoffeeScriptWithMap = function(sourceCode, filename) {
    var comment, compiled;
    compiled = coffee.compile(sourceCode, {
      filename: filename,
      sourceMap: true,
      inline: true,
      literate: path.extname(filename) !== '.coffee'
    });
    comment = convert.fromJSON(compiled.v3SourceMap).setProperty('sources', [filename]).toComment();
    return "" + compiled.js + "\n" + comment + "\n";
  };

  compileIfNeeded = function(srcFile) {
    var destExt, destFile, destStat, err, saveResult, src, srcExt, srcStat, t;
    if (/\.(coffee|coffee\.md|litcoffee|jade|styl)$/i.test(srcFile)) {
      srcExt = path.extname(srcFile);
      destExt = (function() {
        switch (srcExt) {
          case '.jade':
            return '.html';
          case '.styl':
            return '.css';
          default:
            return '.js';
        }
      })();
      destFile = srcFile.slice(0, -srcExt.length) + destExt;
      t = Date.now();
      saveResult = function(data) {
        var ms, n;
        n = data.length;
        ms = Date.now() - t;
        console.log("[node] compile " + srcFile + " -> " + destExt + " " + n + "b " + ms + " ms");
        return fs.writeFileSync(destFile, data);
      };
      try {
        srcStat = fs.statSync(srcFile);
        if (fs.existsSync(destFile)) {
          destStat = fs.statSync(destFile);
        }
        if (!((destStat != null ? destStat.mtime : void 0) >= srcStat.mtime)) {
          src = fs.readFileSync(srcFile, {
            encoding: 'utf8'
          });
          switch (srcExt) {
            case '.jade':
              return saveResult(jade.compile(src, {
                filename: srcFile,
                pretty: true
              })());
            case '.styl':
              return stylus.render(src, {
                filename: srcFile
              }, function(err, css) {
                if (err) {
                  return console.log('[node] stylus error', srcFile, err);
                } else {
                  return saveResult(css);
                }
              });
            default:
              return saveResult(compileCoffeeScriptWithMap(src, path.basename(srcFile)));
          }
        }
      } catch (_error) {
        err = _error;
        return console.log('[node] cannot compile', srcFile, err);
      }
    } else if (pid > 0) {
      if (/\.(html|js)$/i.test(srcFile)) {
        return main.send(true);
      } else if (/\.(css)$/i.test(srcFile)) {
        return main.send(false);
      } else if (/\.(go)$/i.test(srcFile)) {
        console.log("[node] changed", srcFile);
        return recompileGoFiles();
      }
    }
  };

  traverseDirs = function(dir, cb) {
    var f, stats, _i, _len, _ref, _results;
    stats = fs.statSync(dir);
    if (stats.isDirectory()) {
      cb(dir);
      _ref = fs.readdirSync(dir);
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        f = _ref[_i];
        _results.push(traverseDirs(path.join(dir, f), cb));
      }
      return _results;
    }
  };

  watchDir = function(root, cb) {
    return traverseDirs(root, function(dir) {
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        return cb(event, file);
      });
    });
  };

  createWatcher = function(root) {
    console.log(" ", root);
    traverseDirs(root, function(dir) {
      var f, _i, _len, _ref;
      _ref = fs.readdirSync(dir);
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        f = _ref[_i];
        compileIfNeeded(path.join(dir, f));
      }
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        if (fs.existsSync(file)) {
          return compileIfNeeded(file);
        } else {

        }
      });
    });
    return root;
  };

  parseSettings = function(fn) {
    var i, k, line, map, s, v, x, _i, _j, _len, _len1, _ref, _ref1;
    map = {};
    if (fs.existsSync(fn)) {
      _ref = fs.readFileSync(fn, 'utf8').split('\n');
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        line = _ref[_i];
        line = line.trim();
        i = line.indexOf('=');
        if (line[0] !== '#' && i > 0) {
          x = [];
          _ref1 = line.slice(0, i).trim().split('_');
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            s = _ref1[_j];
            x.push(s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase());
          }
          k = x.join("");
          v = line.slice(i + 1).trim();
          map[k] = JSON.parse(v);
        }
      }
    }
    return map;
  };

  runMain();

  console.log('[node] watching for file changes in:');

  settings = require(path.resolve(__dirname, '../setup')).settings;

  createWatcher((settings != null ? settings.appDir : void 0) || './app');

  createWatcher((settings != null ? settings.baseDir : void 0) || './base');

  createWatcher((settings != null ? settings.commonDir : void 0) || './common');

  createWatcher((settings != null ? settings.gadgetsDir : void 0) || './gadgets');

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV2bW9kZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0E7QUFBQSxNQUFBLG1OQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBQUwsQ0FBQTs7QUFBQSxFQUNBLElBQUEsR0FBTyxPQUFBLENBQVEsTUFBUixDQURQLENBQUE7O0FBQUEsRUFFQyxRQUFTLE9BQUEsQ0FBUSxlQUFSLEVBQVQsS0FGRCxDQUFBOztBQUFBLEVBS0EsU0FBQSxHQUFZLFNBQUMsQ0FBRCxHQUFBO1dBQU8sSUFBSSxDQUFDLE9BQUwsQ0FBYSxjQUFiLEVBQTZCLENBQTdCLEVBQVA7RUFBQSxDQUxaLENBQUE7O0FBQUEsRUFPQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFNBQUEsQ0FBVSxlQUFWLENBQVIsQ0FQVCxDQUFBOztBQUFBLEVBUUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFBLENBQVUsb0JBQVYsQ0FBUixDQVJWLENBQUE7O0FBQUEsRUFTQSxJQUFBLEdBQU8sT0FBQSxDQUFRLFNBQUEsQ0FBVSxNQUFWLENBQVIsQ0FUUCxDQUFBOztBQUFBLEVBVUEsTUFBQSxHQUFTLE9BQUEsQ0FBUSxTQUFBLENBQVUsUUFBVixDQUFSLENBVlQsQ0FBQTs7QUFBQSxFQVlBLEtBQUEsR0FBUSxTQUFDLENBQUQsR0FBQTtBQUNOLElBQUEsT0FBTyxDQUFDLEtBQVIsQ0FBYyx1QkFBZCxFQUF1QyxDQUF2QyxDQUFBLENBQUE7V0FDQSxPQUFPLENBQUMsSUFBUixDQUFhLENBQWIsRUFGTTtFQUFBLENBWlIsQ0FBQTs7QUFBQSxFQWdCQSxJQUFBLEdBQU8sTUFoQlAsQ0FBQTs7QUFBQSxFQWlCQSxHQUFBLEdBQU0sTUFqQk4sQ0FBQTs7QUFBQSxFQW9CQSxPQUFBLEdBQVUsU0FBQSxHQUFBO0FBQ1IsUUFBQSx1QkFBQTtBQUFBLElBQUEsSUFBQSxHQUFPLENBQUMsS0FBRCxDQUFQLENBQUE7QUFDQTtBQUFB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LENBQVEsQ0FBUixFQUFXLENBQVgsQ0FBYSxDQUFDLFdBQWQsQ0FBQSxDQUFBLEdBQThCLENBQUMsQ0FBQyxLQUFGLENBQVEsQ0FBUixDQUFVLENBQUMsV0FBWCxDQUFBLENBQXJDLENBQUEsQ0FERjtBQUFBLFdBREE7QUFBQSxVQUdBLENBQUEsR0FBSSxDQUFDLENBQUMsSUFBRixDQUFPLEVBQVAsQ0FISixDQUFBO0FBQUEsVUFJQSxDQUFBLEdBQUksSUFBSSxDQUFDLEtBQUwsQ0FBVyxDQUFBLEdBQUUsQ0FBYixDQUFlLENBQUMsSUFBaEIsQ0FBQSxDQUpKLENBQUE7QUFBQSxVQUtBLEdBQUksQ0FBQSxDQUFBLENBQUosR0FBUyxJQUFJLENBQUMsS0FBTCxDQUFXLENBQVgsQ0FMVCxDQURGO1NBSEY7QUFBQSxPQURGO0tBREE7V0FZQSxJQWJjO0VBQUEsQ0EvSGhCLENBQUE7O0FBQUEsRUFnSkEsT0FBQSxDQUFBLENBaEpBLENBQUE7O0FBQUEsRUFrSkEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxzQ0FBWixDQWxKQSxDQUFBOztBQUFBLEVBb0pBLFFBQUEsR0FBVyxPQUFBLENBQVEsSUFBSSxDQUFDLE9BQUwsQ0FBYSxTQUFiLEVBQXdCLFVBQXhCLENBQVIsQ0FBMkMsQ0FBQyxRQXBKdkQsQ0FBQTs7QUFBQSxFQXFKQSxhQUFBLHFCQUFjLFFBQVEsQ0FBRSxnQkFBVixJQUFvQixPQUFsQyxDQXJKQSxDQUFBOztBQUFBLEVBc0pBLGFBQUEscUJBQWMsUUFBUSxDQUFFLGlCQUFWLElBQXFCLFFBQW5DLENBdEpBLENBQUE7O0FBQUEsRUF1SkEsYUFBQSxxQkFBYyxRQUFRLENBQUUsbUJBQVYsSUFBdUIsVUFBckMsQ0F2SkEsQ0FBQTs7QUFBQSxFQXdKQSxhQUFBLHFCQUFjLFFBQVEsQ0FBRSxvQkFBVixJQUF3QixXQUF0QyxDQXhKQSxDQUFBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIjIEplZUJ1cyBkZXZlbG9wbWVudCBtb2RlOiByZS1jb21waWxlcyBHbyBhbmQgQ1MvSmFkZS9TdHlsdXMgYXMgbmVlZGVkXG4jIC1qY3csIDIwMTQtMDItMTlcblxuZnMgPSByZXF1aXJlICdmcydcbnBhdGggPSByZXF1aXJlICdwYXRoJ1xue3NwYXdufSA9IHJlcXVpcmUgJ2NoaWxkX3Byb2Nlc3MnXG5cbiMgbG9vayBmb3IgbW9kdWxlcyByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBkaXJlY3RvcnksIG5vdCByZWxhdGl2ZSB0byB0aGlzIGZpbGVcbm1vZHVsZURpciA9IChzKSAtPiBwYXRoLnJlc29sdmUgJ25vZGVfbW9kdWxlcycsIHNcblxuY29mZmVlID0gcmVxdWlyZSBtb2R1bGVEaXIgJ2NvZmZlZS1zY3JpcHQnXG5jb252ZXJ0ID0gcmVxdWlyZSBtb2R1bGVEaXIgJ2NvbnZlcnQtc291cmNlLW1hcCdcbmphZGUgPSByZXF1aXJlIG1vZHVsZURpciAnamFkZSdcbnN0eWx1cyA9IHJlcXVpcmUgbW9kdWxlRGlyICdzdHlsdXMnXG5cbmZhdGFsID0gKHMpIC0+XG4gIGNvbnNvbGUuZXJyb3IgJ1xcbltub2RlXSBmYXRhbCBlcnJvcjonLCBzXG4gIHByb2Nlc3MuZXhpdCAxXG5cbm1haW4gPSB1bmRlZmluZWRcbnBpZCA9IHVuZGVmaW5lZFxuXG4jIGxhdW5jaCB0aGUgbWFpbiBhcHAgYnkgY29tcGlsaW5nIGFsbCBpdHMgLmdvIGZpbGVzIHZpYSBcImdvIGdldFwiXG5ydW5NYWluID0gLT5cbiAgYXJncyA9IFsncnVuJ11cbiAgZm9yIGYgaW4gZnMucmVhZGRpclN5bmMgJy4nXG4gICAgaWYgL1xcLmdvJC9pLnRlc3QoZikgYW5kIG5vdCAvX3Rlc3RcXC4vaS50ZXN0KGYpXG4gICAgICBhcmdzLnB1c2ggZlxuICAgICAgZnMud2F0Y2ggZiwgcmVjb21waWxlR29GaWxlc1xuICBjb25zb2xlLmxvZyAnW25vZGVdIGdvJywgYXJncy5qb2luICcgJ1xuICBtYWluID0gc3Bhd24gJ2dvJywgYXJncywgc3RkaW86IFsnaXBjJywgcHJvY2Vzcy5zdGRvdXQsIHByb2Nlc3Muc3RkZXJyXVxuICBtYWluLm9uICdlcnJvcicsIChlcnIpIC0+XG4gICAgZmF0YWwgJ2Nhbm5vdCBsYXVuY2ggXCJnb1wiJ1xuICBtYWluLm9uICdtZXNzYWdlJywgKG1zZykgLT5cbiAgICBjb25zb2xlLmxvZyAnW25vZGVdIHBpZCBtZXNzYWdlOicsIG1zZ1xuICAgIHBpZCA9IG1zZyB8IDAgIyB0aGlzIGlzIG9ubHkgPiAwIHdoZW4gYSBwbGFpbiBudW1iZXIgaXMgcmVjZWl2ZWRcbiAgbWFpbi5vbiAnY2xvc2UnLCAoY29kZSkgLT5cbiAgICBmYXRhbCAndW5leHBlY3RlZCB0ZXJtaW5hdGlvbiBvZiBcIm1haW5cIiwgY29kZTogJyArIGNvZGUgIGlmIGNvZGUgPiAwXG4gIG1haW4ub24gJ2V4aXQnLCAtPlxuICAgIGZhdGFsICdtYWluIGV4aXRlZCdcblxuIyByZS1jb21waWxlIHdoZW4gYSAuZ28gZmlsZXMgY2hhbmdlcywgaWYgdGhlIHJ1bm5pbmcgcHJvY2VzcyBpcyBrbm93blxucmVjb21waWxlR29GaWxlcyA9IC0+XG4gIGlmIHBpZCA+IDBcbiAgICBtYWluLnJlbW92ZUFsbExpc3RlbmVycygpICMgcHJldmVudCB0cmlnZ2VyaW5nIG9uIHRoZSAnZXhpdCcgZXZlbnRcbiAgICBwcm9jZXNzLmtpbGwgcGlkLCAnU0lHSFVQJ1xuICAgIHBpZCA9IDBcbiAgICBydW5NYWluKClcblxuY29tcGlsZUNvZmZlZVNjcmlwdFdpdGhNYXAgPSAoc291cmNlQ29kZSwgZmlsZW5hbWUpIC0+XG4gIGNvbXBpbGVkID0gY29mZmVlLmNvbXBpbGUgc291cmNlQ29kZSxcbiAgICBmaWxlbmFtZTogZmlsZW5hbWVcbiAgICBzb3VyY2VNYXA6IHRydWVcbiAgICBpbmxpbmU6IHRydWVcbiAgICBsaXRlcmF0ZTogcGF0aC5leHRuYW1lKGZpbGVuYW1lKSBpc250ICcuY29mZmVlJ1xuICBjb21tZW50ID0gY29udmVydFxuICAgIC5mcm9tSlNPTihjb21waWxlZC52M1NvdXJjZU1hcClcbiAgICAuc2V0UHJvcGVydHkoJ3NvdXJjZXMnLCBbZmlsZW5hbWVdKSBcbiAgICAudG9Db21tZW50KClcbiAgXCIje2NvbXBpbGVkLmpzfVxcbiN7Y29tbWVudH1cXG5cIlxuICBcbmNvbXBpbGVJZk5lZWRlZCA9IChzcmNGaWxlKSAtPlxuICBpZiAvXFwuKGNvZmZlZXxjb2ZmZWVcXC5tZHxsaXRjb2ZmZWV8amFkZXxzdHlsKSQvaS50ZXN0IHNyY0ZpbGVcbiAgICBzcmNFeHQgPSBwYXRoLmV4dG5hbWUgc3JjRmlsZVxuICAgIGRlc3RFeHQgPSBzd2l0Y2ggc3JjRXh0XG4gICAgICB3aGVuICcuamFkZScgdGhlbiAnLmh0bWwnXG4gICAgICB3aGVuICcuc3R5bCcgdGhlbiAnLmNzcydcbiAgICAgIGVsc2UgICAgICAgICAgICAgICcuanMnXG4gICAgZGVzdEZpbGUgPSBzcmNGaWxlLnNsaWNlKDAsIC0gc3JjRXh0Lmxlbmd0aCkgKyBkZXN0RXh0XG5cbiAgICB0ID0gRGF0ZS5ub3coKVxuICAgIHNhdmVSZXN1bHQgPSAoZGF0YSkgLT5cbiAgICAgIG4gPSBkYXRhLmxlbmd0aFxuICAgICAgbXMgPSBEYXRlLm5vdygpIC0gdFxuICAgICAgY29uc29sZS5sb2cgXCJbbm9kZV0gY29tcGlsZSAje3NyY0ZpbGV9IC0+ICN7ZGVzdEV4dH0gI3tufWIgI3ttc30gbXNcIlxuICAgICAgZnMud3JpdGVGaWxlU3luYyBkZXN0RmlsZSwgZGF0YVxuXG4gICAgdHJ5XG4gICAgICBzcmNTdGF0ID0gZnMuc3RhdFN5bmMgc3JjRmlsZVxuICAgICAgZGVzdFN0YXQgPSBmcy5zdGF0U3luYyBkZXN0RmlsZSAgaWYgZnMuZXhpc3RzU3luYyBkZXN0RmlsZVxuICAgICAgdW5sZXNzIGRlc3RTdGF0Py5tdGltZSA+PSBzcmNTdGF0Lm10aW1lXG4gICAgICAgIHNyYyA9IGZzLnJlYWRGaWxlU3luYyBzcmNGaWxlLCBlbmNvZGluZzogJ3V0ZjgnXG4gICAgICAgIHN3aXRjaCBzcmNFeHRcbiAgICAgICAgICB3aGVuICcuamFkZSdcbiAgICAgICAgICAgIHNhdmVSZXN1bHQgZG8gamFkZS5jb21waWxlIHNyYywgZmlsZW5hbWU6IHNyY0ZpbGUsIHByZXR0eTogdHJ1ZVxuICAgICAgICAgIHdoZW4gJy5zdHlsJ1xuICAgICAgICAgICAgc3R5bHVzLnJlbmRlciBzcmMsIHsgZmlsZW5hbWU6IHNyY0ZpbGUgfSwgKGVyciwgY3NzKSAtPlxuICAgICAgICAgICAgICBpZiBlcnJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyAnW25vZGVdIHN0eWx1cyBlcnJvcicsIHNyY0ZpbGUsIGVyclxuICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2F2ZVJlc3VsdCBjc3NcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBzYXZlUmVzdWx0IGNvbXBpbGVDb2ZmZWVTY3JpcHRXaXRoTWFwIHNyYywgcGF0aC5iYXNlbmFtZSBzcmNGaWxlXG4gICAgY2F0Y2ggZXJyXG4gICAgICBjb25zb2xlLmxvZyAnW25vZGVdIGNhbm5vdCBjb21waWxlJywgc3JjRmlsZSwgZXJyXG4gIGVsc2UgaWYgcGlkID4gMFxuICAgIGlmIC9cXC4oaHRtbHxqcykkL2kudGVzdCBzcmNGaWxlXG4gICAgICBtYWluLnNlbmQgdHJ1ZSAjIHJlcXVlc3QgYSBmdWxsIHBhZ2UgcmVsb2FkXG4gICAgZWxzZSBpZiAvXFwuKGNzcykkL2kudGVzdCBzcmNGaWxlXG4gICAgICBtYWluLnNlbmQgZmFsc2UgIyByZXF1ZXN0IGEgc3R5bGVzaGVldCByZWxvYWRcbiAgICBlbHNlIGlmIC9cXC4oZ28pJC9pLnRlc3Qgc3JjRmlsZVxuICAgICAgY29uc29sZS5sb2cgXCJbbm9kZV0gY2hhbmdlZFwiLCBzcmNGaWxlXG4gICAgICByZWNvbXBpbGVHb0ZpbGVzKClcblxudHJhdmVyc2VEaXJzID0gKGRpciwgY2IpIC0+ICMgcmVjdXJzaXZlIGRpcmVjdG9yeSB0cmF2ZXJzYWxcbiAgc3RhdHMgPSBmcy5zdGF0U3luYyBkaXJcbiAgaWYgc3RhdHMuaXNEaXJlY3RvcnkoKVxuICAgIGNiIGRpclxuICAgIGZvciBmIGluIGZzLnJlYWRkaXJTeW5jIGRpclxuICAgICAgdHJhdmVyc2VEaXJzIHBhdGguam9pbihkaXIsIGYpLCBjYlxuXG53YXRjaERpciA9IChyb290LCBjYikgLT4gIyByZWN1cnNpdmUgZGlyZWN0b3J5IHdhdGNoZXJcbiAgdHJhdmVyc2VEaXJzIHJvb3QsIChkaXIpIC0+XG4gICAgZnMud2F0Y2ggZGlyLCAoZXZlbnQsIGZpbGVuYW1lKSAtPlxuICAgICAgZmlsZSA9IHBhdGguam9pbiBkaXIsIGZpbGVuYW1lXG4gICAgICBjYiBldmVudCwgZmlsZVxuXG5jcmVhdGVXYXRjaGVyID0gKHJvb3QpIC0+XG4gIGNvbnNvbGUubG9nIFwiIFwiLCByb290XG4gIHRyYXZlcnNlRGlycyByb290LCAoZGlyKSAtPlxuICAgIGZvciBmIGluIGZzLnJlYWRkaXJTeW5jIGRpclxuICAgICAgY29tcGlsZUlmTmVlZGVkIHBhdGguam9pbiBkaXIsIGZcbiAgICBmcy53YXRjaCBkaXIsIChldmVudCwgZmlsZW5hbWUpIC0+XG4gICAgICBmaWxlID0gcGF0aC5qb2luIGRpciwgZmlsZW5hbWVcbiAgICAgIGlmIGZzLmV4aXN0c1N5bmMgZmlsZVxuICAgICAgICBjb21waWxlSWZOZWVkZWQgZmlsZVxuICAgICAgZWxzZVxuICAgICAgICAjIFRPRE86IGRlbGV0ZSBjb21waWxlZCBmaWxlXG4gIHJvb3RcblxucGFyc2VTZXR0aW5ncyA9IChmbikgLT5cbiAgbWFwID0ge31cbiAgaWYgZnMuZXhpc3RzU3luYyBmblxuICAgIGZvciBsaW5lIGluIGZzLnJlYWRGaWxlU3luYyhmbiwgJ3V0ZjgnKS5zcGxpdCAnXFxuJ1xuICAgICAgbGluZSA9IGxpbmUudHJpbSgpXG4gICAgICBpID0gbGluZS5pbmRleE9mKCc9JylcbiAgICAgIGlmIGxpbmVbMF0gIT0gJyMnIGFuZCBpID4gMFxuICAgICAgICB4ID0gW11cbiAgICAgICAgZm9yIHMgaW4gbGluZS5zbGljZSgwLCBpKS50cmltKCkuc3BsaXQgJ18nXG4gICAgICAgICAgeC5wdXNoIHMuc2xpY2UoMCwgMSkudG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSkudG9Mb3dlckNhc2UoKVxuICAgICAgICBrID0geC5qb2luIFwiXCJcbiAgICAgICAgdiA9IGxpbmUuc2xpY2UoaSsxKS50cmltKClcbiAgICAgICAgbWFwW2tdID0gSlNPTi5wYXJzZSB2XG4gIG1hcFxuXG4jIFN0YXJ0IG9mIGRldm1vZGUgYXBwbGljYXRpb24gY29kZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5ydW5NYWluKClcblxuY29uc29sZS5sb2cgJ1tub2RlXSB3YXRjaGluZyBmb3IgZmlsZSBjaGFuZ2VzIGluOidcblxuc2V0dGluZ3MgPSByZXF1aXJlKHBhdGgucmVzb2x2ZSBfX2Rpcm5hbWUsICcuLi9zZXR1cCcpLnNldHRpbmdzXG5jcmVhdGVXYXRjaGVyIHNldHRpbmdzPy5hcHBEaXIgb3IgJy4vYXBwJ1xuY3JlYXRlV2F0Y2hlciBzZXR0aW5ncz8uYmFzZURpciBvciAnLi9iYXNlJ1xuY3JlYXRlV2F0Y2hlciBzZXR0aW5ncz8uY29tbW9uRGlyIG9yICcuL2NvbW1vbidcbmNyZWF0ZVdhdGNoZXIgc2V0dGluZ3M/LmdhZGdldHNEaXIgb3IgJy4vZ2FkZ2V0cydcbiJdfQ==
