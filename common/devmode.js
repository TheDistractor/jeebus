(function() {
  var coffee, compileCoffeeScriptWithMap, compileIfNeeded, convert, createWatcher, fatal, fs, jade, main, moduleDir, parseSettings, path, pid, recompileGoFiles, runMain, settings, spawn, stylus, traverseDirs, watchDir;

  fs = require('fs');

  path = require('path');

  spawn = require('child_process').spawn;

  moduleDir = function(s) {
    return path.resolve('node_modules', s);
  };

  coffee = require(moduleDir('coffee-script'));

  convert = require(moduleDir('convert-source-map'));

  jade = require(moduleDir('jade'));

  stylus = require(moduleDir('stylus'));

  fatal = function(s) {
    console.error('\n[node] fatal error:', s);
    return process.exit(1);
  };

  main = void 0;

  pid = void 0;

  runMain = function() {
    var args, f, _i, _len, _ref;
    args = ['run'];
    _ref = fs.readdirSync('.');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      f = _ref[_i];
      if (path.extname(f) === '.go' && !/_test\./.test(f)) {
        args.push(f);
        fs.watch(f, recompileGoFiles);
      }
    }
    console.log('[node] go', args.join(' '));
    main = spawn('go', args, {
      stdio: ['ipc', process.stdout, process.stderr]
    });
    main.on('error', function(err) {
      return fatal('cannot launch "go"');
    });
    main.on('message', function(msg) {
      console.log('[node] pid message:', msg);
      return pid = msg | 0;
    });
    main.on('close', function(code) {
      if (code > 0) {
        return fatal('unexpected termination of "main", code: ' + code);
      }
    });
    return main.on('exit', function() {
      return fatal('main exited');
    });
  };

  recompileGoFiles = function() {
    if (pid > 0) {
      main.removeAllListeners();
      process.kill(pid, 'SIGHUP');
      pid = 0;
      return runMain();
    }
  };

  compileCoffeeScriptWithMap = function(sourceCode, filename) {
    var comment, compiled;
    compiled = coffee.compile(sourceCode, {
      filename: filename,
      sourceMap: true,
      inline: true,
      literate: path.extname(filename) !== '.coffee'
    });
    comment = convert.fromJSON(compiled.v3SourceMap).setProperty('sources', [filename]).toComment();
    return "" + compiled.js + "\n" + comment + "\n";
  };

  compileIfNeeded = function(srcFile) {
    var destExt, destFile, destStat, err, saveResult, src, srcExt, srcStat, t;
    if (/\.(coffee|coffee\.md|litcoffee|jade|styl)$/i.test(srcFile)) {
      srcExt = path.extname(srcFile);
      destExt = (function() {
        switch (srcExt) {
          case '.jade':
            return '.html';
          case '.styl':
            return '.css';
          default:
            return '.js';
        }
      })();
      destFile = srcFile.slice(0, -srcExt.length) + destExt;
      t = Date.now();
      saveResult = function(data) {
        var ms, n;
        n = data.length;
        ms = Date.now() - t;
        console.log("[node] compile " + srcFile + " -> " + destExt + " " + n + "b " + ms + " ms");
        return fs.writeFileSync(destFile, data);
      };
      try {
        srcStat = fs.statSync(srcFile);
        if (fs.existsSync(destFile)) {
          destStat = fs.statSync(destFile);
        }
        if (!((destStat != null ? destStat.mtime : void 0) >= srcStat.mtime)) {
          src = fs.readFileSync(srcFile, {
            encoding: 'utf8'
          });
          switch (srcExt) {
            case '.jade':
              return saveResult(jade.compile(src, {
                filename: srcFile,
                pretty: true
              })());
            case '.styl':
              return stylus.render(src, {
                filename: srcFile
              }, function(err, css) {
                if (err) {
                  return console.log('[node] stylus error', srcFile, err);
                } else {
                  return saveResult(css);
                }
              });
            default:
              return saveResult(compileCoffeeScriptWithMap(src, path.basename(srcFile)));
          }
        }
      } catch (_error) {
        err = _error;
        return console.log('[node] cannot compile', srcFile, err);
      }
    } else if (/\.(html|js)$/i.test(srcFile)) {
      return main.send(true);
    } else if (/\.(css)$/i.test(srcFile)) {
      return main.send(false);
    }
  };

  traverseDirs = function(dir, cb) {
    var f, stats, _i, _len, _ref, _results;
    stats = fs.statSync(dir);
    if (stats.isDirectory()) {
      cb(dir);
      _ref = fs.readdirSync(dir);
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        f = _ref[_i];
        _results.push(traverseDirs(path.join(dir, f), cb));
      }
      return _results;
    }
  };

  watchDir = function(root, cb) {
    return traverseDirs(root, function(dir) {
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        return cb(event, file);
      });
    });
  };

  createWatcher = function(root) {
    console.log(" ", root);
    traverseDirs(root, function(dir) {
      var f, _i, _len, _ref;
      _ref = fs.readdirSync(dir);
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        f = _ref[_i];
        compileIfNeeded(path.join(dir, f));
      }
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        if (fs.existsSync(file)) {
          return compileIfNeeded(file);
        } else {

        }
      });
    });
    return root;
  };

  parseSettings = function(fn) {
    var i, k, line, map, s, v, x, _i, _j, _len, _len1, _ref, _ref1;
    map = {};
    if (fs.existsSync(fn)) {
      _ref = fs.readFileSync(fn, 'utf8').split('\n');
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        line = _ref[_i];
        line = line.trim();
        i = line.indexOf('=');
        if (line[0] !== '#' && i > 0) {
          x = [];
          _ref1 = line.slice(0, i).trim().split('_');
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            s = _ref1[_j];
            x.push(s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase());
          }
          k = x.join("");
          v = line.slice(i + 1).trim();
          map[k] = JSON.parse(v);
        }
      }
    }
    return map;
  };

  runMain();

  console.log('[node] watching for file changes in:');

  try {
    settings = require('./setup').settings;
  } catch (_error) {}

  createWatcher((settings != null ? settings.AppDir : void 0) || './app');

  createWatcher((settings != null ? settings.BaseDir : void 0) || './base');

  createWatcher((settings != null ? settings.CommonDir : void 0) || './common');

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV2bW9kZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0E7QUFBQSxNQUFBLG1OQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBQUwsQ0FBQTs7QUFBQSxFQUNBLElBQUEsR0FBTyxPQUFBLENBQVEsTUFBUixDQURQLENBQUE7O0FBQUEsRUFFQyxRQUFTLE9BQUEsQ0FBUSxlQUFSLEVBQVQsS0FGRCxDQUFBOztBQUFBLEVBS0EsU0FBQSxHQUFZLFNBQUMsQ0FBRCxHQUFBO1dBQU8sSUFBSSxDQUFDLE9BQUwsQ0FBYSxjQUFiLEVBQTZCLENBQTdCLEVBQVA7RUFBQSxDQUxaLENBQUE7O0FBQUEsRUFPQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFNBQUEsQ0FBVSxlQUFWLENBQVIsQ0FQVCxDQUFBOztBQUFBLEVBUUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFBLENBQVUsb0JBQVYsQ0FBUixDQVJWLENBQUE7O0FBQUEsRUFTQSxJQUFBLEdBQU8sT0FBQSxDQUFRLFNBQUEsQ0FBVSxNQUFWLENBQVIsQ0FUUCxDQUFBOztBQUFBLEVBVUEsTUFBQSxHQUFTLE9BQUEsQ0FBUSxTQUFBLENBQVUsUUFBVixDQUFSLENBVlQsQ0FBQTs7QUFBQSxFQVlBLEtBQUEsR0FBUSxTQUFDLENBQUQsR0FBQTtBQUNOLElBQUEsT0FBTyxDQUFDLEtBQVIsQ0FBYyx1QkFBZCxFQUF1QyxDQUF2QyxDQUFBLENBQUE7V0FDQSxPQUFPLENBQUMsSUFBUixDQUFhLENBQWIsRUFGTTtFQUFBLENBWlIsQ0FBQTs7QUFBQSxFQWdCQSxJQUFBLEdBQU8sTUFoQlAsQ0FBQTs7QUFBQSxFQWlCQSxHQUFBLEdBQU0sTUFqQk4sQ0FBQTs7QUFBQSxFQW9CQSxPQUFBLEdBQVUsU0FBQSxHQUFBO0FBQ1IsUUFBQSx1QkFBQTtBQUFBLElBQUEsSUFBQSxHQUFPLENBQUMsS0FBRCxDQUFQLENBQUE7QUFDQTtBQUFB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QyxJQUFGLENBQU8sRUFBUCxDQUhKLENBQUE7QUFBQSxVQUlBLENBQUEsR0FBSSxJQUFJLENBQUMsS0FBTCxDQUFXLENBQUEsR0FBRSxDQUFiLENBQWUsQ0FBQyxJQUFoQixDQUFBLENBSkosQ0FBQTtBQUFBLFVBS0EsR0FBSSxDQUFBLENBQUEsQ0FBSixHQUFTLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxDQUxULENBREY7U0FIRjtBQUFBLE9BREY7S0FEQTtXQVlBLElBYmM7RUFBQSxDQTVIaEIsQ0FBQTs7QUFBQSxFQTZJQSxPQUFBLENBQUEsQ0E3SUEsQ0FBQTs7QUFBQSxFQStJQSxPQUFPLENBQUMsR0FBUixDQUFZLHNDQUFaLENBL0lBLENBQUE7O0FBaUpBO0FBQUksSUFBQSxRQUFBLEdBQVcsT0FBQSxDQUFRLFNBQVIsQ0FBa0IsQ0FBQyxRQUE5QixDQUFKO0dBQUEsa0JBakpBOztBQUFBLEVBa0pBLGFBQUEscUJBQWMsUUFBUSxDQUFFLGdCQUFWLElBQW9CLE9BQWxDLENBbEpBLENBQUE7O0FBQUEsRUFtSkEsYUFBQSxxQkFBYyxRQUFRLENBQUUsaUJBQVYsSUFBcUIsUUFBbkMsQ0FuSkEsQ0FBQTs7QUFBQSxFQW9KQSxhQUFBLHFCQUFjLFFBQVEsQ0FBRSxtQkFBVixJQUF1QixVQUFyQyxDQXBKQSxDQUFBO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIjIEplZUJ1cyBkZXZlbG9wbWVudCBtb2RlOiByZS1jb21waWxlcyBHbyBhbmQgQ1MvSmFkZS9TdHlsdXMgYXMgbmVlZGVkXG4jIC1qY3csIDIwMTQtMDItMTlcblxuZnMgPSByZXF1aXJlICdmcydcbnBhdGggPSByZXF1aXJlICdwYXRoJ1xue3NwYXdufSA9IHJlcXVpcmUgJ2NoaWxkX3Byb2Nlc3MnXG5cbiMgbG9vayBmb3IgbW9kdWxlcyByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBkaXJlY3RvcnksIG5vdCByZWxhdGl2ZSB0byB0aGlzIGZpbGVcbm1vZHVsZURpciA9IChzKSAtPiBwYXRoLnJlc29sdmUgJ25vZGVfbW9kdWxlcycsIHNcblxuY29mZmVlID0gcmVxdWlyZSBtb2R1bGVEaXIgJ2NvZmZlZS1zY3JpcHQnXG5jb252ZXJ0ID0gcmVxdWlyZSBtb2R1bGVEaXIgJ2NvbnZlcnQtc291cmNlLW1hcCdcbmphZGUgPSByZXF1aXJlIG1vZHVsZURpciAnamFkZSdcbnN0eWx1cyA9IHJlcXVpcmUgbW9kdWxlRGlyICdzdHlsdXMnXG5cbmZhdGFsID0gKHMpIC0+XG4gIGNvbnNvbGUuZXJyb3IgJ1xcbltub2RlXSBmYXRhbCBlcnJvcjonLCBzXG4gIHByb2Nlc3MuZXhpdCAxXG5cbm1haW4gPSB1bmRlZmluZWRcbnBpZCA9IHVuZGVmaW5lZFxuXG4jIGxhdW5jaCB0aGUgbWFpbiBhcHAgYnkgY29tcGlsaW5nIGFsbCBpdHMgLmdvIGZpbGVzIHZpYSBcImdvIGdldFwiXG5ydW5NYWluID0gLT5cbiAgYXJncyA9IFsncnVuJ11cbiAgZm9yIGYgaW4gZnMucmVhZGRpclN5bmMgJy4nXG4gICAgaWYgcGF0aC5leHRuYW1lKGYpIGlzICcuZ28nIGFuZCBub3QgL190ZXN0XFwuLy50ZXN0IGZcbiAgICAgIGFyZ3MucHVzaCBmXG4gICAgICBmcy53YXRjaCBmLCByZWNvbXBpbGVHb0ZpbGVzXG4gIGNvbnNvbGUubG9nICdbbm9kZV0gZ28nLCBhcmdzLmpvaW4gJyAnXG4gIG1haW4gPSBzcGF3biAnZ28nLCBhcmdzLCBzdGRpbzogWydpcGMnLCBwcm9jZXNzLnN0ZG91dCwgcHJvY2Vzcy5zdGRlcnJdXG4gIG1haW4ub24gJ2Vycm9yJywgKGVycikgLT5cbiAgICBmYXRhbCAnY2Fubm90IGxhdW5jaCBcImdvXCInXG4gIG1haW4ub24gJ21lc3NhZ2UnLCAobXNnKSAtPlxuICAgIGNvbnNvbGUubG9nICdbbm9kZV0gcGlkIG1lc3NhZ2U6JywgbXNnXG4gICAgcGlkID0gbXNnIHwgMCAjIHRoaXMgaXMgb25seSA+IDAgd2hlbiBhIHBsYWluIG51bWJlciBpcyByZWNlaXZlZFxuICBtYWluLm9uICdjbG9zZScsIChjb2RlKSAtPlxuICAgIGZhdGFsICd1bmV4cGVjdGVkIHRlcm1pbmF0aW9uIG9mIFwibWFpblwiLCBjb2RlOiAnICsgY29kZSAgaWYgY29kZSA+IDBcbiAgbWFpbi5vbiAnZXhpdCcsIC0+XG4gICAgZmF0YWwgJ21haW4gZXhpdGVkJ1xuXG4jIHJlLWNvbXBpbGUgd2hlbiBhIC5nbyBmaWxlcyBjaGFuZ2VzLCBpZiB0aGUgcnVubmluZyBwcm9jZXNzIGlzIGtub3duXG5yZWNvbXBpbGVHb0ZpbGVzID0gLT5cbiAgaWYgcGlkID4gMFxuICAgIG1haW4ucmVtb3ZlQWxsTGlzdGVuZXJzKCkgIyBwcmV2ZW50IHRyaWdnZXJpbmcgb24gdGhlICdleGl0JyBldmVudFxuICAgIHByb2Nlc3Mua2lsbCBwaWQsICdTSUdIVVAnXG4gICAgcGlkID0gMFxuICAgIHJ1bk1haW4oKVxuXG5jb21waWxlQ29mZmVlU2NyaXB0V2l0aE1hcCA9IChzb3VyY2VDb2RlLCBmaWxlbmFtZSkgLT5cbiAgY29tcGlsZWQgPSBjb2ZmZWUuY29tcGlsZSBzb3VyY2VDb2RlLFxuICAgIGZpbGVuYW1lOiBmaWxlbmFtZVxuICAgIHNvdXJjZU1hcDogdHJ1ZVxuICAgIGlubGluZTogdHJ1ZVxuICAgIGxpdGVyYXRlOiBwYXRoLmV4dG5hbWUoZmlsZW5hbWUpIGlzbnQgJy5jb2ZmZWUnXG4gIGNvbW1lbnQgPSBjb252ZXJ0XG4gICAgLmZyb21KU09OKGNvbXBpbGVkLnYzU291cmNlTWFwKVxuICAgIC5zZXRQcm9wZXJ0eSgnc291cmNlcycsIFtmaWxlbmFtZV0pIFxuICAgIC50b0NvbW1lbnQoKVxuICBcIiN7Y29tcGlsZWQuanN9XFxuI3tjb21tZW50fVxcblwiXG4gIFxuY29tcGlsZUlmTmVlZGVkID0gKHNyY0ZpbGUpIC0+XG4gIGlmIC9cXC4oY29mZmVlfGNvZmZlZVxcLm1kfGxpdGNvZmZlZXxqYWRlfHN0eWwpJC9pLnRlc3Qgc3JjRmlsZVxuICAgIHNyY0V4dCA9IHBhdGguZXh0bmFtZSBzcmNGaWxlXG4gICAgZGVzdEV4dCA9IHN3aXRjaCBzcmNFeHRcbiAgICAgIHdoZW4gJy5qYWRlJyB0aGVuICcuaHRtbCdcbiAgICAgIHdoZW4gJy5zdHlsJyB0aGVuICcuY3NzJ1xuICAgICAgZWxzZSAgICAgICAgICAgICAgJy5qcydcbiAgICBkZXN0RmlsZSA9IHNyY0ZpbGUuc2xpY2UoMCwgLSBzcmNFeHQubGVuZ3RoKSArIGRlc3RFeHRcblxuICAgIHQgPSBEYXRlLm5vdygpXG4gICAgc2F2ZVJlc3VsdCA9IChkYXRhKSAtPlxuICAgICAgbiA9IGRhdGEubGVuZ3RoXG4gICAgICBtcyA9IERhdGUubm93KCkgLSB0XG4gICAgICBjb25zb2xlLmxvZyBcIltub2RlXSBjb21waWxlICN7c3JjRmlsZX0gLT4gI3tkZXN0RXh0fSAje259YiAje21zfSBtc1wiXG4gICAgICBmcy53cml0ZUZpbGVTeW5jIGRlc3RGaWxlLCBkYXRhXG5cbiAgICB0cnlcbiAgICAgIHNyY1N0YXQgPSBmcy5zdGF0U3luYyBzcmNGaWxlXG4gICAgICBkZXN0U3RhdCA9IGZzLnN0YXRTeW5jIGRlc3RGaWxlICBpZiBmcy5leGlzdHNTeW5jIGRlc3RGaWxlXG4gICAgICB1bmxlc3MgZGVzdFN0YXQ/Lm10aW1lID49IHNyY1N0YXQubXRpbWVcbiAgICAgICAgc3JjID0gZnMucmVhZEZpbGVTeW5jIHNyY0ZpbGUsIGVuY29kaW5nOiAndXRmOCdcbiAgICAgICAgc3dpdGNoIHNyY0V4dFxuICAgICAgICAgIHdoZW4gJy5qYWRlJ1xuICAgICAgICAgICAgc2F2ZVJlc3VsdCBkbyBqYWRlLmNvbXBpbGUgc3JjLCBmaWxlbmFtZTogc3JjRmlsZSwgcHJldHR5OiB0cnVlXG4gICAgICAgICAgd2hlbiAnLnN0eWwnXG4gICAgICAgICAgICBzdHlsdXMucmVuZGVyIHNyYywgeyBmaWxlbmFtZTogc3JjRmlsZSB9LCAoZXJyLCBjc3MpIC0+XG4gICAgICAgICAgICAgIGlmIGVyclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nICdbbm9kZV0gc3R5bHVzIGVycm9yJywgc3JjRmlsZSwgZXJyXG4gICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzYXZlUmVzdWx0IGNzc1xuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIHNhdmVSZXN1bHQgY29tcGlsZUNvZmZlZVNjcmlwdFdpdGhNYXAgc3JjLCBwYXRoLmJhc2VuYW1lIHNyY0ZpbGVcbiAgICBjYXRjaCBlcnJcbiAgICAgIGNvbnNvbGUubG9nICdbbm9kZV0gY2Fubm90IGNvbXBpbGUnLCBzcmNGaWxlLCBlcnJcbiAgZWxzZSBpZiAvXFwuKGh0bWx8anMpJC9pLnRlc3Qgc3JjRmlsZVxuICAgIG1haW4uc2VuZCB0cnVlICMgcmVxdWVzdCBhIGZ1bGwgcGFnZSByZWxvYWRcbiAgZWxzZSBpZiAvXFwuKGNzcykkL2kudGVzdCBzcmNGaWxlXG4gICAgbWFpbi5zZW5kIGZhbHNlICMgcmVxdWVzdCBhIHN0eWxlc2hlZXQgcmVsb2FkXG5cbnRyYXZlcnNlRGlycyA9IChkaXIsIGNiKSAtPiAjIHJlY3Vyc2l2ZSBkaXJlY3RvcnkgdHJhdmVyc2FsXG4gIHN0YXRzID0gZnMuc3RhdFN5bmMgZGlyXG4gIGlmIHN0YXRzLmlzRGlyZWN0b3J5KClcbiAgICBjYiBkaXJcbiAgICBmb3IgZiBpbiBmcy5yZWFkZGlyU3luYyBkaXJcbiAgICAgIHRyYXZlcnNlRGlycyBwYXRoLmpvaW4oZGlyLCBmKSwgY2Jcblxud2F0Y2hEaXIgPSAocm9vdCwgY2IpIC0+ICMgcmVjdXJzaXZlIGRpcmVjdG9yeSB3YXRjaGVyXG4gIHRyYXZlcnNlRGlycyByb290LCAoZGlyKSAtPlxuICAgIGZzLndhdGNoIGRpciwgKGV2ZW50LCBmaWxlbmFtZSkgLT5cbiAgICAgIGZpbGUgPSBwYXRoLmpvaW4gZGlyLCBmaWxlbmFtZVxuICAgICAgY2IgZXZlbnQsIGZpbGVcblxuY3JlYXRlV2F0Y2hlciA9IChyb290KSAtPlxuICBjb25zb2xlLmxvZyBcIiBcIiwgcm9vdFxuICB0cmF2ZXJzZURpcnMgcm9vdCwgKGRpcikgLT5cbiAgICAjIGNvbnNvbGUubG9nICdkOicsIGRpclxuICAgIGZvciBmIGluIGZzLnJlYWRkaXJTeW5jIGRpclxuICAgICAgY29tcGlsZUlmTmVlZGVkIHBhdGguam9pbiBkaXIsIGZcbiAgICBmcy53YXRjaCBkaXIsIChldmVudCwgZmlsZW5hbWUpIC0+XG4gICAgICBmaWxlID0gcGF0aC5qb2luIGRpciwgZmlsZW5hbWVcbiAgICAgIGlmIGZzLmV4aXN0c1N5bmMgZmlsZVxuICAgICAgICBjb21waWxlSWZOZWVkZWQgZmlsZVxuICAgICAgZWxzZVxuICAgICAgICAjIFRPRE86IGRlbGV0ZSBjb21waWxlZCBmaWxlXG4gIHJvb3RcblxucGFyc2VTZXR0aW5ncyA9IChmbikgLT5cbiAgbWFwID0ge31cbiAgaWYgZnMuZXhpc3RzU3luYyBmblxuICAgIGZvciBsaW5lIGluIGZzLnJlYWRGaWxlU3luYyhmbiwgJ3V0ZjgnKS5zcGxpdCAnXFxuJ1xuICAgICAgbGluZSA9IGxpbmUudHJpbSgpXG4gICAgICBpID0gbGluZS5pbmRleE9mKCc9JylcbiAgICAgIGlmIGxpbmVbMF0gIT0gJyMnIGFuZCBpID4gMFxuICAgICAgICB4ID0gW11cbiAgICAgICAgZm9yIHMgaW4gbGluZS5zbGljZSgwLCBpKS50cmltKCkuc3BsaXQgJ18nXG4gICAgICAgICAgeC5wdXNoIHMuc2xpY2UoMCwgMSkudG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSkudG9Mb3dlckNhc2UoKVxuICAgICAgICBrID0geC5qb2luIFwiXCJcbiAgICAgICAgdiA9IGxpbmUuc2xpY2UoaSsxKS50cmltKClcbiAgICAgICAgbWFwW2tdID0gSlNPTi5wYXJzZSB2XG4gIG1hcFxuXG4jIFN0YXJ0IG9mIGRldm1vZGUgYXBwbGljYXRpb24gY29kZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5ydW5NYWluKClcblxuY29uc29sZS5sb2cgJ1tub2RlXSB3YXRjaGluZyBmb3IgZmlsZSBjaGFuZ2VzIGluOidcblxudHJ5IHNldHRpbmdzID0gcmVxdWlyZSgnLi9zZXR1cCcpLnNldHRpbmdzXG5jcmVhdGVXYXRjaGVyIHNldHRpbmdzPy5BcHBEaXIgb3IgJy4vYXBwJ1xuY3JlYXRlV2F0Y2hlciBzZXR0aW5ncz8uQmFzZURpciBvciAnLi9iYXNlJ1xuY3JlYXRlV2F0Y2hlciBzZXR0aW5ncz8uQ29tbW9uRGlyIG9yICcuL2NvbW1vbidcbiJdfQ==
