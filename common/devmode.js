(function() {
  var coffee, compileCoffeeScriptWithMap, compileIfNeeded, convert, createWatcher, fatal, fs, jade, main, moduleDir, parseSettings, path, runMain, settings, spawn, stylus, traverseDirs, watchDir;

  fs = require('fs');

  path = require('path');

  spawn = require('child_process').spawn;

  moduleDir = function(s) {
    return path.resolve('node_modules', s);
  };

  coffee = require(moduleDir('coffee-script'));

  convert = require(moduleDir('convert-source-map'));

  jade = require(moduleDir('jade'));

  stylus = require(moduleDir('stylus'));

  fatal = function(s) {
    console.error('\n[node] fatal error:', s);
    return process.exit(1);
  };

  main = void 0;

  runMain = function() {
    var args, f, _i, _len, _ref;
    args = ['run'];
    _ref = fs.readdirSync('.');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      f = _ref[_i];
      if (path.extname(f) === '.go' && !/_test\./.test(f)) {
        args.push(f);
      }
    }
    console.log('[node] go', args.join(' '));
    main = spawn('go', args, {
      stdio: ['ipc', process.stdout, process.stderr]
    });
    main.on('close', function(code) {
      if (code > 0) {
        return fatal('unexpected termination of "main", code: ' + code);
      }
    });
    main.on('error', function(err) {
      return fatal('cannot launch "go"');
    });
    return main.on('exit', function() {
      return fatal('main exited');
    });
  };

  compileCoffeeScriptWithMap = function(sourceCode, filename) {
    var comment, compiled;
    compiled = coffee.compile(sourceCode, {
      filename: filename,
      sourceMap: true,
      inline: true,
      literate: path.extname(filename) !== '.coffee'
    });
    comment = convert.fromJSON(compiled.v3SourceMap).setProperty('sources', [filename]).toComment();
    return "" + compiled.js + "\n" + comment + "\n";
  };

  compileIfNeeded = function(srcFile) {
    var destExt, destFile, destStat, err, saveResult, src, srcExt, srcStat, t;
    if (/\.(coffee|coffee\.md|litcoffee|jade|styl)$/i.test(srcFile)) {
      srcExt = path.extname(srcFile);
      destExt = (function() {
        switch (srcExt) {
          case '.jade':
            return '.html';
          case '.styl':
            return '.css';
          default:
            return '.js';
        }
      })();
      destFile = srcFile.slice(0, -srcExt.length) + destExt;
      t = Date.now();
      saveResult = function(data) {
        var ms, n;
        n = data.length;
        ms = Date.now() - t;
        console.log("[node] compile " + srcFile + " -> " + destExt + " " + n + "b " + ms + " ms");
        return fs.writeFileSync(destFile, data);
      };
      try {
        srcStat = fs.statSync(srcFile);
        if (fs.existsSync(destFile)) {
          destStat = fs.statSync(destFile);
        }
        if (!((destStat != null ? destStat.mtime : void 0) >= srcStat.mtime)) {
          src = fs.readFileSync(srcFile, {
            encoding: 'utf8'
          });
          switch (srcExt) {
            case '.jade':
              return saveResult(jade.compile(src, {
                filename: srcFile,
                pretty: true
              })());
            case '.styl':
              return stylus.render(src, {
                filename: srcFile
              }, function(err, css) {
                if (err) {
                  return console.log('[node] stylus error', srcFile, err);
                } else {
                  return saveResult(css);
                }
              });
            default:
              return saveResult(compileCoffeeScriptWithMap(src, path.basename(srcFile)));
          }
        }
      } catch (_error) {
        err = _error;
        return console.log('[node] cannot compile', srcFile, err);
      }
    } else if (/\.(html|js)$/i.test(srcFile)) {
      return main.send(true);
    } else if (/\.(css)$/i.test(srcFile)) {
      return main.send(false);
    }
  };

  traverseDirs = function(dir, cb) {
    var f, stats, _i, _len, _ref, _results;
    stats = fs.statSync(dir);
    if (stats.isDirectory()) {
      cb(dir);
      _ref = fs.readdirSync(dir);
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        f = _ref[_i];
        _results.push(traverseDirs(path.join(dir, f), cb));
      }
      return _results;
    }
  };

  watchDir = function(root, cb) {
    return traverseDirs(root, function(dir) {
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        return cb(event, file);
      });
    });
  };

  createWatcher = function(root) {
    console.log(" ", root);
    traverseDirs(root, function(dir) {
      var f, _i, _len, _ref;
      _ref = fs.readdirSync(dir);
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        f = _ref[_i];
        compileIfNeeded(path.join(dir, f));
      }
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        if (fs.existsSync(file)) {
          return compileIfNeeded(file);
        } else {

        }
      });
    });
    return root;
  };

  parseSettings = function(fn) {
    var i, k, line, map, s, v, x, _i, _j, _len, _len1, _ref, _ref1;
    map = {};
    if (fs.existsSync(fn)) {
      _ref = fs.readFileSync(fn, 'utf8').split('\n');
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        line = _ref[_i];
        line = line.trim();
        i = line.indexOf('=');
        if (line[0] !== '#' && i > 0) {
          x = [];
          _ref1 = line.slice(0, i).trim().split('_');
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            s = _ref1[_j];
            x.push(s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase());
          }
          k = x.join("");
          v = line.slice(i + 1).trim();
          map[k] = JSON.parse(v);
        }
      }
    }
    return map;
  };

  runMain();

  process.on('message', function(msg) {
    return console.log('got message:', msg);
  });

  console.log('[node] watching for file changes in:');

  try {
    settings = require('./setup').settings;
  } catch (_error) {}

  createWatcher((settings != null ? settings.AppDir : void 0) || './app');

  createWatcher((settings != null ? settings.BaseDir : void 0) || './base');

  createWatcher((settings != null ? settings.CommonDir : void 0) || './common');

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV2bW9kZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0E7QUFBQSxNQUFBLDRMQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBQUwsQ0FBQTs7QUFBQSxFQUNBLElBQUEsR0FBTyxPQUFBLENBQVEsTUFBUixDQURQLENBQUE7O0FBQUEsRUFFQyxRQUFTLE9BQUEsQ0FBUSxlQUFSLEVBQVQsS0FGRCxDQUFBOztBQUFBLEVBS0EsU0FBQSxHQUFZLFNBQUMsQ0FBRCxHQUFBO1dBQU8sSUFBSSxDQUFDLE9BQUwsQ0FBYSxjQUFiLEVBQTZCLENBQTdCLEVBQVA7RUFBQSxDQUxaLENBQUE7O0FBQUEsRUFPQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFNBQUEsQ0FBVSxlQUFWLENBQVIsQ0FQVCxDQUFBOztBQUFBLEVBUUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFBLENBQVUsb0JBQVYsQ0FBUixDQVJWLENBQUE7O0FBQUEsRUFTQSxJQUFBLEdBQU8sT0FBQSxDQUFRLFNBQUEsQ0FBVSxNQUFWLENBQVIsQ0FUUCxDQUFBOztBQUFBLEVBVUEsTUFBQSxHQUFTLE9BQUEsQ0FBUSxTQUFBLENBQVUsUUFBVixDQUFSLENBVlQsQ0FBQTs7QUFBQSxFQVlBLEtBQUEsR0FBUSxTQUFDLENBQUQsR0FBQTtBQUNOLElBQUEsT0FBTyxDQUFDLEtBQVIsQ0FBYyx1QkFBZCxFQUF1QyxDQUF2QyxDQUFBLENBQUE7V0FDQSxPQUFPLENBQUMsSUFBUixDQUFhLENBQWIsRUFGTTtFQUFBLENBWlIsQ0FBQTs7QUFBQSxFQWdCQSxJQUFBLEdBQU8sTUFoQlAsQ0FBQTs7QUFBQSxFQWtCQSxPQUFBLEdBQVUsU0FBQSxHQUFBO0FBQ1IsUUFBQSx1QkFBQTtBQUFBLElBQUEsSUFBQSxHQUFPLENBQUMsS0FBRCxDQUFQLENBQUE7QUFDQTtBQUFBLFNBQUEsMkNBQUE7bUJBQUE7QUFDRSxNQUFBLElBQWdC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QUFDLFFBQTlCLENBQUo7R0FBQSxrQkFySUE7O0FBQUEsRUFzSUEsYUFBQSxxQkFBYyxRQUFRLENBQUUsZ0JBQVYsSUFBb0IsT0FBbEMsQ0F0SUEsQ0FBQTs7QUFBQSxFQXVJQSxhQUFBLHFCQUFjLFFBQVEsQ0FBRSxpQkFBVixJQUFxQixRQUFuQyxDQXZJQSxDQUFBOztBQUFBLEVBd0lBLGFBQUEscUJBQWMsUUFBUSxDQUFFLG1CQUFWLElBQXVCLFVBQXJDLENBeElBLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIiMgSmVlQnVzIGRldmVsb3BtZW50IG1vZGU6IHJlLWNvbXBpbGVzIENTL0phZGUvU3R5bHVzIGFzIG5lZWRlZFxuIyAtamN3LCAyMDE0LTAyLTE5XG5cbmZzID0gcmVxdWlyZSAnZnMnXG5wYXRoID0gcmVxdWlyZSAncGF0aCdcbntzcGF3bn0gPSByZXF1aXJlICdjaGlsZF9wcm9jZXNzJ1xuXG4jIGxvb2sgZm9yIG1vZHVsZXMgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgZGlyZWN0b3J5LCBub3QgcmVsYXRpdmUgdG8gdGhpcyBmaWxlXG5tb2R1bGVEaXIgPSAocykgLT4gcGF0aC5yZXNvbHZlICdub2RlX21vZHVsZXMnLCBzXG5cbmNvZmZlZSA9IHJlcXVpcmUgbW9kdWxlRGlyICdjb2ZmZWUtc2NyaXB0J1xuY29udmVydCA9IHJlcXVpcmUgbW9kdWxlRGlyICdjb252ZXJ0LXNvdXJjZS1tYXAnXG5qYWRlID0gcmVxdWlyZSBtb2R1bGVEaXIgJ2phZGUnXG5zdHlsdXMgPSByZXF1aXJlIG1vZHVsZURpciAnc3R5bHVzJ1xuXG5mYXRhbCA9IChzKSAtPlxuICBjb25zb2xlLmVycm9yICdcXG5bbm9kZV0gZmF0YWwgZXJyb3I6Jywgc1xuICBwcm9jZXNzLmV4aXQgMVxuXG5tYWluID0gdW5kZWZpbmVkXG5cbnJ1bk1haW4gPSAtPlxuICBhcmdzID0gWydydW4nLCBdXG4gIGZvciBmIGluIGZzLnJlYWRkaXJTeW5jICcuJ1xuICAgIGFyZ3MucHVzaCBmICBpZiBwYXRoLmV4dG5hbWUoZikgaXMgJy5nbycgYW5kIG5vdCAvX3Rlc3RcXC4vLnRlc3QgZlxuICBjb25zb2xlLmxvZyAnW25vZGVdIGdvJywgYXJncy5qb2luICcgJ1xuICBtYWluID0gc3Bhd24gJ2dvJywgYXJncywgc3RkaW86IFsnaXBjJywgcHJvY2Vzcy5zdGRvdXQsIHByb2Nlc3Muc3RkZXJyXVxuICBtYWluLm9uICdjbG9zZScsIChjb2RlKSAtPlxuICAgIGZhdGFsICd1bmV4cGVjdGVkIHRlcm1pbmF0aW9uIG9mIFwibWFpblwiLCBjb2RlOiAnICsgY29kZSAgaWYgY29kZSA+IDBcbiAgbWFpbi5vbiAnZXJyb3InLCAoZXJyKSAtPlxuICAgIGZhdGFsICdjYW5ub3QgbGF1bmNoIFwiZ29cIidcbiAgbWFpbi5vbiAnZXhpdCcsIC0+XG4gICAgZmF0YWwgJ21haW4gZXhpdGVkJ1xuICBcbmNvbXBpbGVDb2ZmZWVTY3JpcHRXaXRoTWFwID0gKHNvdXJjZUNvZGUsIGZpbGVuYW1lKSAtPlxuICBjb21waWxlZCA9IGNvZmZlZS5jb21waWxlIHNvdXJjZUNvZGUsXG4gICAgZmlsZW5hbWU6IGZpbGVuYW1lXG4gICAgc291cmNlTWFwOiB0cnVlXG4gICAgaW5saW5lOiB0cnVlXG4gICAgbGl0ZXJhdGU6IHBhdGguZXh0bmFtZShmaWxlbmFtZSkgaXNudCAnLmNvZmZlZSdcbiAgY29tbWVudCA9IGNvbnZlcnRcbiAgICAuZnJvbUpTT04oY29tcGlsZWQudjNTb3VyY2VNYXApXG4gICAgLnNldFByb3BlcnR5KCdzb3VyY2VzJywgW2ZpbGVuYW1lXSkgXG4gICAgLnRvQ29tbWVudCgpXG4gIFwiI3tjb21waWxlZC5qc31cXG4je2NvbW1lbnR9XFxuXCJcbiAgXG5jb21waWxlSWZOZWVkZWQgPSAoc3JjRmlsZSkgLT5cbiAgaWYgL1xcLihjb2ZmZWV8Y29mZmVlXFwubWR8bGl0Y29mZmVlfGphZGV8c3R5bCkkL2kudGVzdCBzcmNGaWxlXG4gICAgc3JjRXh0ID0gcGF0aC5leHRuYW1lIHNyY0ZpbGVcbiAgICBkZXN0RXh0ID0gc3dpdGNoIHNyY0V4dFxuICAgICAgd2hlbiAnLmphZGUnIHRoZW4gJy5odG1sJ1xuICAgICAgd2hlbiAnLnN0eWwnIHRoZW4gJy5jc3MnXG4gICAgICBlbHNlICAgICAgICAgICAgICAnLmpzJ1xuICAgIGRlc3RGaWxlID0gc3JjRmlsZS5zbGljZSgwLCAtIHNyY0V4dC5sZW5ndGgpICsgZGVzdEV4dFxuXG4gICAgdCA9IERhdGUubm93KClcbiAgICBzYXZlUmVzdWx0ID0gKGRhdGEpIC0+XG4gICAgICBuID0gZGF0YS5sZW5ndGhcbiAgICAgIG1zID0gRGF0ZS5ub3coKSAtIHRcbiAgICAgIGNvbnNvbGUubG9nIFwiW25vZGVdIGNvbXBpbGUgI3tzcmNGaWxlfSAtPiAje2Rlc3RFeHR9ICN7bn1iICN7bXN9IG1zXCJcbiAgICAgIGZzLndyaXRlRmlsZVN5bmMgZGVzdEZpbGUsIGRhdGFcblxuICAgIHRyeVxuICAgICAgc3JjU3RhdCA9IGZzLnN0YXRTeW5jIHNyY0ZpbGVcbiAgICAgIGRlc3RTdGF0ID0gZnMuc3RhdFN5bmMgZGVzdEZpbGUgIGlmIGZzLmV4aXN0c1N5bmMgZGVzdEZpbGVcbiAgICAgIHVubGVzcyBkZXN0U3RhdD8ubXRpbWUgPj0gc3JjU3RhdC5tdGltZVxuICAgICAgICBzcmMgPSBmcy5yZWFkRmlsZVN5bmMgc3JjRmlsZSwgZW5jb2Rpbmc6ICd1dGY4J1xuICAgICAgICBzd2l0Y2ggc3JjRXh0XG4gICAgICAgICAgd2hlbiAnLmphZGUnXG4gICAgICAgICAgICBzYXZlUmVzdWx0IGRvIGphZGUuY29tcGlsZSBzcmMsIGZpbGVuYW1lOiBzcmNGaWxlLCBwcmV0dHk6IHRydWVcbiAgICAgICAgICB3aGVuICcuc3R5bCdcbiAgICAgICAgICAgIHN0eWx1cy5yZW5kZXIgc3JjLCB7IGZpbGVuYW1lOiBzcmNGaWxlIH0sIChlcnIsIGNzcykgLT5cbiAgICAgICAgICAgICAgaWYgZXJyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cgJ1tub2RlXSBzdHlsdXMgZXJyb3InLCBzcmNGaWxlLCBlcnJcbiAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHNhdmVSZXN1bHQgY3NzXG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgc2F2ZVJlc3VsdCBjb21waWxlQ29mZmVlU2NyaXB0V2l0aE1hcCBzcmMsIHBhdGguYmFzZW5hbWUgc3JjRmlsZVxuICAgIGNhdGNoIGVyclxuICAgICAgY29uc29sZS5sb2cgJ1tub2RlXSBjYW5ub3QgY29tcGlsZScsIHNyY0ZpbGUsIGVyclxuICBlbHNlIGlmIC9cXC4oaHRtbHxqcykkL2kudGVzdCBzcmNGaWxlXG4gICAgbWFpbi5zZW5kIHRydWUgIyByZXF1ZXN0IGEgZnVsbCBwYWdlIHJlbG9hZFxuICBlbHNlIGlmIC9cXC4oY3NzKSQvaS50ZXN0IHNyY0ZpbGVcbiAgICBtYWluLnNlbmQgZmFsc2UgIyByZXF1ZXN0IGEgc3R5bGVzaGVldCByZWxvYWRcblxudHJhdmVyc2VEaXJzID0gKGRpciwgY2IpIC0+ICMgcmVjdXJzaXZlIGRpcmVjdG9yeSB0cmF2ZXJzYWxcbiAgc3RhdHMgPSBmcy5zdGF0U3luYyBkaXJcbiAgaWYgc3RhdHMuaXNEaXJlY3RvcnkoKVxuICAgIGNiIGRpclxuICAgIGZvciBmIGluIGZzLnJlYWRkaXJTeW5jIGRpclxuICAgICAgdHJhdmVyc2VEaXJzIHBhdGguam9pbihkaXIsIGYpLCBjYlxuXG53YXRjaERpciA9IChyb290LCBjYikgLT4gIyByZWN1cnNpdmUgZGlyZWN0b3J5IHdhdGNoZXJcbiAgdHJhdmVyc2VEaXJzIHJvb3QsIChkaXIpIC0+XG4gICAgZnMud2F0Y2ggZGlyLCAoZXZlbnQsIGZpbGVuYW1lKSAtPlxuICAgICAgZmlsZSA9IHBhdGguam9pbiBkaXIsIGZpbGVuYW1lXG4gICAgICBjYiBldmVudCwgZmlsZVxuXG5jcmVhdGVXYXRjaGVyID0gKHJvb3QpIC0+XG4gIGNvbnNvbGUubG9nIFwiIFwiLCByb290XG4gIHRyYXZlcnNlRGlycyByb290LCAoZGlyKSAtPlxuICAgICMgY29uc29sZS5sb2cgJ2Q6JywgZGlyXG4gICAgZm9yIGYgaW4gZnMucmVhZGRpclN5bmMgZGlyXG4gICAgICBjb21waWxlSWZOZWVkZWQgcGF0aC5qb2luIGRpciwgZlxuICAgIGZzLndhdGNoIGRpciwgKGV2ZW50LCBmaWxlbmFtZSkgLT5cbiAgICAgIGZpbGUgPSBwYXRoLmpvaW4gZGlyLCBmaWxlbmFtZVxuICAgICAgaWYgZnMuZXhpc3RzU3luYyBmaWxlXG4gICAgICAgIGNvbXBpbGVJZk5lZWRlZCBmaWxlXG4gICAgICBlbHNlXG4gICAgICAgICMgVE9ETzogZGVsZXRlIGNvbXBpbGVkIGZpbGVcbiAgcm9vdFxuXG5wYXJzZVNldHRpbmdzID0gKGZuKSAtPlxuICBtYXAgPSB7fVxuICBpZiBmcy5leGlzdHNTeW5jIGZuXG4gICAgZm9yIGxpbmUgaW4gZnMucmVhZEZpbGVTeW5jKGZuLCAndXRmOCcpLnNwbGl0ICdcXG4nXG4gICAgICBsaW5lID0gbGluZS50cmltKClcbiAgICAgIGkgPSBsaW5lLmluZGV4T2YoJz0nKVxuICAgICAgaWYgbGluZVswXSAhPSAnIycgYW5kIGkgPiAwXG4gICAgICAgIHggPSBbXVxuICAgICAgICBmb3IgcyBpbiBsaW5lLnNsaWNlKDAsIGkpLnRyaW0oKS5zcGxpdCAnXydcbiAgICAgICAgICB4LnB1c2ggcy5zbGljZSgwLCAxKS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGsgPSB4LmpvaW4gXCJcIlxuICAgICAgICB2ID0gbGluZS5zbGljZShpKzEpLnRyaW0oKVxuICAgICAgICBtYXBba10gPSBKU09OLnBhcnNlIHZcbiAgbWFwXG5cbiMgU3RhcnQgb2YgZGV2bW9kZSBhcHBsaWNhdGlvbiBjb2RlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbnJ1bk1haW4oKVxuXG5wcm9jZXNzLm9uICdtZXNzYWdlJywgKG1zZykgLT5cbiAgY29uc29sZS5sb2cgJ2dvdCBtZXNzYWdlOicsIG1zZ1xuICBcbmNvbnNvbGUubG9nICdbbm9kZV0gd2F0Y2hpbmcgZm9yIGZpbGUgY2hhbmdlcyBpbjonXG5cbnRyeSBzZXR0aW5ncyA9IHJlcXVpcmUoJy4vc2V0dXAnKS5zZXR0aW5nc1xuY3JlYXRlV2F0Y2hlciBzZXR0aW5ncz8uQXBwRGlyIG9yICcuL2FwcCdcbmNyZWF0ZVdhdGNoZXIgc2V0dGluZ3M/LkJhc2VEaXIgb3IgJy4vYmFzZSdcbmNyZWF0ZVdhdGNoZXIgc2V0dGluZ3M/LkNvbW1vbkRpciBvciAnLi9jb21tb24nXG4iXX0=
