(function() {
  var coffee, compileCoffeeScriptWithMap, compileIfNeeded, convert, createWatcher, execFile, fatal, fs, gin, installGin, jade, moduleDir, parseSettings, path, ready, runGin, saveResult, settings, spawn, stylus, traverseDirs, watchDir, _ref,
    __slice = [].slice;

  fs = require('fs');

  path = require('path');

  _ref = require('child_process'), execFile = _ref.execFile, spawn = _ref.spawn;

  moduleDir = function(s) {
    return path.resolve('node_modules', s);
  };

  coffee = require(moduleDir('coffee-script'));

  convert = require(moduleDir('convert-source-map'));

  jade = require(moduleDir('jade'));

  stylus = require(moduleDir('stylus'));

  fatal = function() {
    var args, s;
    s = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    console.error('\n[node] fatal error:', s);
    if (args.length) {
      console.error.apply(console, args);
    }
    return process.exit(1);
  };

  runGin = function(done) {
    var p;
    p = spawn('gin', [], {
      stdio: 'pipe'
    });
    p.on('close', function(code) {
      if (code > 0) {
        return fatal('unexpected termination of "gin", code: ' + code);
      }
    });
    p.stdout.on('data', function(data) {
      var s;
      s = data.toString();
      if (data.length > 0) {
        process.stdout.write(s);
      }
      if (/listening on port/.test(s)) {
        return ready();
      }
    });
    p.stderr.on('data', function(data) {
      var s;
      s = data.toString();
      if (!/execvp\(\)/.test(s)) {
        return process.stderr.write(s);
      }
    });
    return p;
  };

  installGin = function() {
    console.log('"gin" tool not found, installing...');
    return execFile('go', ['get', 'github.com/codegangsta/gin'], function(err, sout, serr) {
      var gin;
      if (err) {
        if (err.code === 'ENOENT') {
          fatal('"go" not found - please install it first, see http://golang.org/');
        }
        fatal('install of "gin" failed', serr);
      }
      gin = runGin();
      return gin.on('error', function(err) {
        return fatal('still cannot launch "gin" - is $GOPATH/bin in your $PATH?');
      });
    });
  };

  compileCoffeeScriptWithMap = function(sourceCode, filename) {
    var comment, compiled;
    compiled = coffee.compile(sourceCode, {
      filename: filename,
      sourceMap: true,
      inline: true,
      literate: path.extname(filename) !== '.coffee'
    });
    comment = convert.fromJSON(compiled.v3SourceMap).setProperty('sources', [filename]).toComment();
    return "" + compiled.js + "\n" + comment + "\n";
  };

  compileIfNeeded = function(srcFile) {
    var destExt, destFile, destStat, err, html, js, src, srcExt, srcStat;
    if (/\.(coffee|coffee\.md|litcoffee|jade|styl)$/.test(srcFile)) {
      srcExt = path.extname(srcFile);
      switch (srcExt) {
        case '.jade':
          destExt = '.html';
          break;
        case '.styl':
          destExt = '.css';
          break;
        default:
          destExt = '.js';
      }
      destFile = srcFile.slice(0, -srcExt.length) + destExt;
      try {
        srcStat = fs.statSync(srcFile);
        if (fs.existsSync(destFile)) {
          destStat = fs.statSync(destFile);
        }
        if (!((destStat != null ? destStat.mtime : void 0) >= srcStat.mtime)) {
          src = fs.readFileSync(srcFile, {
            encoding: 'utf8'
          });
          switch (srcExt) {
            case '.jade':
              html = jade.compile(src, {
                filename: srcFile,
                pretty: true
              })();
              return saveResult(destFile, html);
            case '.styl':
              return stylus.render(src, {
                filename: srcFile
              }, function(err, css) {
                if (err) {
                  return console.log('[node] stylus error', srcFile, err);
                } else {
                  return saveResult(destFile, css);
                }
              });
            default:
              js = compileCoffeeScriptWithMap(src, path.basename(srcFile));
              return saveResult(destFile, js);
          }
        }
      } catch (_error) {
        err = _error;
        return console.log('[node] cannot compile', srcFile, err);
      }
    }
  };

  saveResult = function(file, text) {
    console.log("[node] saved " + file + " (" + text.length + "b)");
    return fs.writeFileSync(file, text);
  };

  traverseDirs = function(dir, cb) {
    var f, stats, _i, _len, _ref1, _results;
    stats = fs.statSync(dir);
    if (stats.isDirectory()) {
      cb(dir);
      _ref1 = fs.readdirSync(dir);
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        f = _ref1[_i];
        _results.push(traverseDirs(path.join(dir, f), cb));
      }
      return _results;
    }
  };

  watchDir = function(root, cb) {
    return traverseDirs(root, function(dir) {
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        return cb(event, file);
      });
    });
  };

  createWatcher = function(root) {
    console.log(" ", root);
    traverseDirs(root, function(dir) {
      var f, _i, _len, _ref1;
      _ref1 = fs.readdirSync(dir);
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        f = _ref1[_i];
        compileIfNeeded(path.join(dir, f));
      }
      return fs.watch(dir, function(event, filename) {
        var file;
        file = path.join(dir, filename);
        if (fs.existsSync(file)) {
          return compileIfNeeded(file);
        } else {

        }
      });
    });
    return root;
  };

  ready = function() {
    console.log('[node] watching for file changes in:');
    createWatcher(settings.AppDir || './app');
    createWatcher(settings.BaseDir || './base');
    return createWatcher(settings.CommonDir || './common');
  };

  parseSettings = function(fn) {
    var i, k, line, map, s, v, x, _i, _j, _len, _len1, _ref1, _ref2;
    if (fn == null) {
      fn = 'settings.txt';
    }
    map = {};
    if (fs.existsSync(fn)) {
      _ref1 = fs.readFileSync(fn, 'utf8').split('\n');
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        line = _ref1[_i];
        line = line.trim();
        i = line.indexOf('=');
        if (line[0] !== '#' && i > 0) {
          x = [];
          _ref2 = line.slice(0, i).trim().split('_');
          for (_j = 0, _len1 = _ref2.length; _j < _len1; _j++) {
            s = _ref2[_j];
            x.push(s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase());
          }
          k = x.join("");
          v = line.slice(i + 1).trim();
          map[k] = JSON.parse(v);
        }
      }
    }
    return map;
  };

  settings = parseSettings();

  gin = runGin();

  gin.on('error', function(err) {
    if (err.code !== 'ENOENT') {
      fatal('cannot launch "gin"', err);
    }
    return installGin();
  });

  gin.on('exit', function() {
    console.error('[node] gin exited');
    return process.exit(1);
  });

  process.on('uncaughtException', function(err) {
    console.error('[node] exception:', err.stack);
    return gin.kill();
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV2bW9kZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0E7QUFBQSxNQUFBLHlPQUFBO0lBQUEsa0JBQUE7O0FBQUEsRUFBQSxFQUFBLEdBQUssT0FBQSxDQUFRLElBQVIsQ0FBTCxDQUFBOztBQUFBLEVBQ0EsSUFBQSxHQUFPLE9BQUEsQ0FBUSxNQUFSLENBRFAsQ0FBQTs7QUFBQSxFQUVBLE9BQW1CLE9BQUEsQ0FBUSxlQUFSLENBQW5CLEVBQUMsZ0JBQUEsUUFBRCxFQUFVLGFBQUEsS0FGVixDQUFBOztBQUFBLEVBS0EsU0FBQSxHQUFZLFNBQUMsQ0FBRCxHQUFBO1dBQU8sSUFBSSxDQUFDLE9BQUwsQ0FBYSxjQUFiLEVBQTZCLENBQTdCLEVBQVA7RUFBQSxDQUxaLENBQUE7O0FBQUEsRUFPQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFNBQUEsQ0FBVSxlQUFWLENBQVIsQ0FQVCxDQUFBOztBQUFBLEVBUUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFBLENBQVUsb0JBQVYsQ0FBUixDQVJWLENBQUE7O0FBQUEsRUFTQSxJQUFBLEdBQU8sT0FBQSxDQUFRLFNBQUEsQ0FBVSxNQUFWLENBQVIsQ0FUUCxDQUFBOztBQUFBLEVBVUEsTUFBQSxHQUFTLE9BQUEsQ0FBUSxTQUFBLENBQVUsUUFBVixDQUFSLENBVlQsQ0FBQTs7QUFBQSxFQVlBLEtBQUEsR0FBUSxTQUFBLEdBQUE7QUFDTixRQUFBLE9BQUE7QUFBQSxJQURPLGtCQUFHLDhEQUNWLENBQUE7QUFBQSxJQUFBLE9BQU8sQ0FBQyxLQUFSLENBQWMsdUJBQWQsRUFBdUMsQ0FBdkMsQ0FBQSxDQUFBO0FBQ0EsSUFBQSxJQUEwQixJQUFJLENBQUMsTUFBL0I7QUFBQSxNQUFBLE9BQU8sQ0FBQyxLQUFSLGdCQUFjLElBQWQsQ0FBQSxDQUFBO0tBREE7V0FFQSxPQUFPLENBQUMsSUFBUixDQUFhLENBQWIsRUFITTtFQUFBLENBWlIsQ0FBQTs7QUFBQSxFQWlCQSxNQUFBLEdBQVMsU0FBQyxJQUFELEdBQUE7QUFDUCxRQUFBLENBQUE7QUFBQSxJQUFBLENBQUEsR0FBSSxLQUFBLENBQU0sS0FBTixFQUFhLEVBQWIsRUFBaUI7QUFBQSxNQUFBLEtBQUEsRUFBTyxNQUFQO0tBQWpCLENBQUosQ0FBQTtBQUFBLElBQ0EsQ0FBQyxDQUFDLEVBQUYsQ0FBSyxPQUFMLEVBQWMsU0FBQyxJQUFELEdBQUE7QUFDWixNQUFBLElBQTJELElBQUEsR0FBTyxDQUFsRTtlQUFBLEtBQUEsQ0FBTSx5Q0FBQSxHQUE0QyxJQUFsRCxFQUFBO09BRFk7SUFBQSxDQUFkLENBREEsQ0FBQTtBQUFBLElBR0EsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFULENBQVksTUFBWixFQUFvQixTQUFDLElBQUQsR0FBQTtBQUNsQixVQUFBLENBQUE7QUFBQSxNQUFBLENBQUEsR0FBSSxJQUFJLENBQUMsUUFBTCxDQUFBLENBQUosQ0FBQTtBQUNBLE1BQUEsSUFBMEIsSUFBSSxDQUFDLE1BQUwsR0FBYyxDQUF4QztBQUFBLFFBQUEsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFmLENBQXFCLENBQXJCLENBQUEsQ0FBQTtPQURBO0FBRUEsTUFBQSxJQUFZLG1CQUFtQixDQUFDLElBQXBCLENBQXlCLENBQXpCLENBQVo7ZUFBQSxLQUFBLENBQUEsRUFBQTtPQUhrQjtJQUFBLENBQXBCLENBSEEsQ0FBQTtBQUFBLElBT0EsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFULENBQVksTUFBWixFQUFvQixTQUFDLElBQUQsR0FBQTtBQUNsQixVQUFBLENBQUE7QUFBQSxNQUFBLENBQUEsR0FBSSxJQUFJLENBQUMsUUFBTCxDQUFBLENBQUosQ0FBQTtBQUNBLE1BQUEsSUFBQSxDQUFBLFlBQTJDLENBQUMsSUFBYixDQUFrQixDQUFsQixDQUEvQjtlQUFBLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBZixDQUFxQixDQUFyQixFQUFBO09BRmtCO0lBQUEsQ0FBcEIsQ0FQQSxDQUFBO1dBVUEsRUFYTztFQUFBLENBakJULENBQUE7O0FBQUEsRUE4QkEsVUFBQSxHQUFhLFNBQUEsR0FBQTtBQUNYLElBQUEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxxQ0FBWixDQUFBLENBQUE7V0FHQSxRQUFBLENBQVMsSUFBVCxFQUFlLENBQUMsS0FBRCxFQUFRLDRCQUFSLENBQWYsRUFBc0QsU0FBQyxHQUFELEVBQU0sSUFBTixFQUFZLElBQVosR0FBQTtBQUdwRCxVQUFBLEdBQUE7QUFBQSxNQUFBLElBQUcsR0FBSDtBQUNFLFFBQUEsSUFBRyxHQUFHLENBQUMsSUFBSixLQUFZLFFBQWY7QUFDRSxVQUFBLEtBQUEsQ0FBTSxrRUFBTixDQUFBLENBREY7U0FBQTtBQUFBLFFBRUEsS0FBQSxDQUFNLHlCQUFOLEVBQWlDLElBQWpDLENBRkEsQ0FERjtPQUFBO0FBQUEsTUFNQSxHQUFBLEdBQU0sTUFBQSxDQUFBLENBTk4sQ0FBQTthQU9BLEdBQUcsQ0FBQyxFQUFKLENBQU8sT0FBUCxFQUFnQixTQUFDLEdBQUQsR0FBQTtlQUNkLEtBQUEsQ0FBTSwyREFBTixFQURjO01BQUEsQ0FBaEIsRUFWb0Q7SUFBQSxDQUF0RCxFQUpXO0VBQUEsQ0E5QmIsQ0FBQTs7QUFBQSxFQStDQSwwQkFBQSxHQUE2QixTQUFDLFVBQUQsRUFBYSxRQUFiLEdBQUE7QUFDM0IsUUFBQSxpQkFBQTtBQUFBLElBQUEsUUFBQSxHQUFXLE1BQU0sQ0FBQyxPQUFQLENBQWUsVUFBZixFQUNUO0FBQUEsTUFBQSxRQUFBLEVBQVUsUUFBVjtBQUFBLE1BQ0EsU0FBQSxFQUFXLElBRFg7QUFBQSxNQUVBLE1BQUEsRUFBUSxJQUZSO0FBQUEsTUFHQSxRQUFBLEVBQVUsSUFBSSxDQUFDLE9BQUwsQ0FBYSxRQUFiLENBQUEsS0FBNEIsU0FIdEM7S0FEUyxDQUFYLENBQUE7QUFBQSxJQUtBLE9BQUEsR0FBVSxPQUNSLENBQUMsUUFETyxDQUNFLFFBQVEsQ0FBQyxXQURYLENBRVIsQ0FBQyxXQUZPLENBRUssU0FGTCxFQUVnQixDQUFDLFFBQUQsQ0FGaEIsQ0FHUixDQUFDLFNBSE8sQ0FBQSxDQUxWLENBQUE7V0FTQSxFQUFBLEdBQUUsUUFBUSxDQUFDLEVBQVgsR0FBZSxJQUFmLEdBQWtCLE9BQWxCLEdBQTJCLEtBVkE7RUFBQSxDQS9DN0IsQ0FBQTs7QUFBQSxFQTJEQSxlQUFBLEdBQWtCLFNBQUMsT0FBRCxHQUFBO0FBQ2hCLFFBQUEsZ0VBQUE7QUFBQSxJQUFBLElBQUcsNENBQTRDLENBQUMsSUFBN0MsQ0FBa0QsT0FBbEQsQ0FBSDtBQUNFLE1BQUEsTUFBQSxHQUFTLElBQUksQ0FBQyxPQUFMLENBQWEsT0FBYixDQUFULENBQUE7QUFDQSxjQUFPLE1BQVA7QUFBQSxhQUNPLE9BRFA7QUFDb0IsVUFBQSxPQUFBLEdBQVUsT0FBVixDQURwQjtBQUNPO0FBRFAsYUFFTyxPQUZQO0FBRW9CLFVBQUEsT0FBQSxHQUFVLE1BQVYsQ0FGcEI7QUFFTztBQUZQO0FBR29CLFVBQUEsT0FBQSxHQUFVLEtBQVYsQ0FIcEI7QUFBQSxPQURBO0FBQUEsTUFLQSxRQUFBLEdBQVcsT0FBTyxDQUFDLEtBQVIsQ0FBYyxDQUFkLEVBQWlCLENBQUEsTUFBUSxDQUFDLE1BQTFCLENBQUEsR0FBb0MsT0FML0MsQ0FBQTtBQU1BO0FBQ0UsUUFBQSxPQUFBLEdBQVUsRUFBRSxDQUFDLFFBQUgsQ0FBWSxPQUFaLENBQVYsQ0FBQTtBQUNBLFFBQUEsSUFBb0MsRUFBRSxDQUFDLFVBQUgsQ0FBYyxRQUFkLENBQXBDO0FBQUEsVUFBQSxRQUFBLEdBQVcsRUFBRSxDQUFDLFFBQUgsQ0FBWSxRQUFaLENBQVgsQ0FBQTtTQURBO0FBRUEsUUFBQSxJQUFBLENBQUEscUJBQU8sUUFBUSxDQUFFLGVBQVYsSUFBbUIsT0FBTyxDQUFDLEtBQWxDLENBQUE7QUFDRSxVQUFBLEdBQUEsR0FBTSxFQUFFLENBQUMsWUFBSCxDQUFnQixPQUFoQixFQUF5QjtBQUFBLFlBQUEsUUFBQSxFQUFVLE1BQVY7V0FBekIsQ0FBTixDQUFBO0FBQ0Esa0JBQU8sTUFBUDtBQUFBLGlCQUNPLE9BRFA7QUFFSSxjQUFBLElBQUEsR0FBVSxJQUFJLENBQUMsT0FBTCxDQUFhLEdBQWIsRUFBa0I7QUFBQSxnQkFBQSxRQUFBLEVBQVUsT0FBVjtBQUFBLGdCQUFtQixNQUFBLEVBQVEsSUFBM0I7ZUFBbEIsQ0FBSCxDQUFBLENBQVAsQ0FBQTtxQkFDQSxVQUFBLENBQVcsUUFBWCxFQUFxQixJQUFyQixFQUhKO0FBQUEsaUJBSU8sT0FKUDtxQkFLSSxNQUFNLENBQUMsTUFBUCxDQUFjLEdBQWQsRUFBbUI7QUFBQSxnQkFBRSxRQUFBLEVBQVUsT0FBWjtlQUFuQixFQUEwQyxTQUFDLEdBQUQsRUFBTSxHQUFOLEdBQUE7QUFDeEMsZ0JBQUEsSUFBRyxHQUFIO3lCQUNFLE9BQU8sQ0FBQyxHQUFSLENBQVkscUJBQVosRUFBbUMsT0FBbkMsRUFBNEMsR0FBNUMsRUFERjtpQkFBQSxNQUFBO3lCQUdFLFVBQUEsQ0FBVyxRQUFYLEVBQXFCLEdBQXJCLEVBSEY7aUJBRHdDO2NBQUEsQ0FBMUMsRUFMSjtBQUFBO0FBV0ksY0FBQSxFQUFBLEdBQUssMEJBQUEsQ0FBMkIsR0FBM0IsRUFBZ0MsSUFBSSxDQUFDLFFBQUwsQ0FBYyxPQUFkLENBQWhDLENBQUwsQ0FBQTtxQkFDQSxVQUFBLENBQVcsUUFBWCxFQUFxQixFQUFyQixFQVpKO0FBQUEsV0FGRjtTQUhGO09BQUEsY0FBQTtBQW1CRSxRQURJLFlBQ0osQ0FBQTtlQUFBLE9BQU8sQ0FBQyxHQUFSLENBQVksdUJBQVosRUFBcUMsT0FBckMsRUFBOEMsR0FBOUMsRUFuQkY7T0FQRjtLQURnQjtFQUFBLENBM0RsQixDQUFBOztBQUFBLEVBd0ZBLFVBQUEsR0FBYSxTQUFDLElBQUQsRUFBTyxJQUFQLEdBQUE7QUFDWCxJQUFBLE9BQU8sQ0FBQyxHQUFSLENBQWEsZUFBQSxHQUFjLElBQWQsR0FBb0IsSUFBcEIsR0FBdUIsSUFBSSxDQUFDLE1BQTVCLEdBQW9DLElBQWpELENBQUEsQ0FBQTtXQUNBLEVBQUUsQ0FBQyxhQUFILENBQWlCLElBQWpCLEVBQXVCLElBQXZCLEVBRlc7RUFBQSxDQXhGYixDQUFBOztBQUFBLEVBNEZBLFlBQUEsR0FBZSxTQUFDLEdBQUQsRUFBTSxFQUFOLEdBQUE7QUFDYixRQUFBLG1DQUFBO0FBQUEsSUFBQSxLQUFBLEdBQVEsRUFBRSxDQUFDLFFBQUgsQ0FBWSxHQUFaLENBQVIsQ0FBQTtBQUNBLElBQUEsSUFBRyxLQUFLLENBQUMsV0FBTixDQUFBLENBQUg7QUFDRSxNQUFBLEVBQUEsQ0FBRyxHQUFILENBQUEsQ0FBQTtBQUNBO0FBQUE7V0FBQSw0Q0FBQTtzQkFBQTtBQUNFLHNCQUFBLFlBQUEsQ0FBYSxJQUFJLENBQUMsSUFBTCxDQUFVLEdBQVYsRUFBZSxDQUFmLENBQWIsRUFBZ0MsRUFBaEMsRUFBQSxDQURGO0FBQUE7c0JBRkY7S0FGYTtFQUFBLENBNUZmLENBQUE7O0FBQUEsRUFtR0EsUUFBQSxHQUFXLFNBQUMsSUFBRCxFQUFPLEVBQVAsR0FBQTtXQUNULFlBQUEsQ0FBYSxJQUFiLEVBQW1CLFNBQUMsR0FBRCxHQUFBO2FBQ2pCLEVBQUUsQ0FBQyxLQUFILENBQVMsR0FBVCxFQUFjLFNBQUMsS0FBRCxFQUFRLFFBQVIsR0FBQTtBQUNaLFlBQUEsSUFBQTtBQUFBLFFBQUEsSUFBQSxHQUFPLElBQUksQ0FBQyxJQUFMLENBQVUsR0FBVixFQUFlLFFBQWYsQ0FBUCxDQUFBO2VBQ0EsRUFBQSxDQUFHLEtBQUgsRUFBVSxJQUFWLEVBRlk7TUFBQSxDQUFkLEVBRGlCO0lBQUEsQ0FBbkIsRUFEUztFQUFBLENBbkdYLENBQUE7O0FBQUEsRUF5R0EsYUFBQSxHQUFnQixTQUFDLElBQUQsR0FBQTtBQUNkLElBQUEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxHQUFaLEVBQWlCLElBQWpCLENBQUEsQ0FBQTtBQUFBLElBQ0EsWUFBQSxDQUFhLElBQWIsRUFBbUIsU0FBQyxHQUFELEdBQUE7QUFFakIsVUFBQSxrQkFBQTtBQUFBO0FBQUEsV0FBQSw0Q0FBQTtzQkFBQTtBQUNFLFFBQUEsZUFBQSxDQUFnQixJQUFJLENBQUMsSUFBTCxDQUFVLEdBQVYsRUFBZSxDQUFmLENBQWhCLENBQUEsQ0FERjtBQUFBLE9BQUE7YUFFQSxFQUFFLENBQUMsS0FBSCxDQUFTLEdBQVQsRUFBYyxTQUFDLEtBQUQsRUFBUSxRQUFSLEdBQUE7QUFDWixZQUFBLElBQUE7QUFBQSxRQUFBLElBQUEsR0FBTyxJQUFJLENBQUMsSUFBTCxDQUFVLEdBQVYsRUFBZSxRQUFmLENBQVAsQ0FBQTtBQUNBLFFBQUEsSUFBRyxFQUFFLENBQUMsVUFBSCxDQUFjLElBQWQsQ0FBSDtpQkFDRSxlQUFBLENBQWdCLElBQWhCLEVBREY7U0FBQSxNQUFBO0FBQUE7U0FGWTtNQUFBLENBQWQsRUFKaUI7SUFBQSxDQUFuQixDQURBLENBQUE7V0FXQSxLQVpjO0VBQUEsQ0F6R2hCLENBQUE7O0FBQUEsRUF1SEEsS0FBQSxHQUFRLFNBQUEsR0FBQTtBQUNOLElBQUEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxzQ0FBWixDQUFBLENBQUE7QUFBQSxJQUNBLGFBQUEsQ0FBYyxRQUFRLENBQUMsTUFBVCxJQUFtQixPQUFqQyxDQURBLENBQUE7QUFBQSxJQUVBLGFBQUEsQ0FBYyxRQUFRLENBQUMsT0FBVCxJQUFvQixRQUFsQyxDQUZBLENBQUE7V0FHQSxhQUFBLENBQWMsUUFBUSxDQUFDLFNBQVQsSUFBc0IsVUFBcEMsRUFKTTtFQUFBLENBdkhSLENBQUE7O0FBQUEsRUE2SEEsYUFBQSxHQUFnQixTQUFDLEVBQUQsR0FBQTtBQUNkLFFBQUEsMkRBQUE7O01BRGUsS0FBSTtLQUNuQjtBQUFBLElBQUEsR0FBQSxHQUFNLEVBQU4sQ0FBQTtBQUNBLElBQUEsSUFBRyxFQUFFLENBQUMsVUFBSCxDQUFjLEVBQWQsQ0FBSDtBQUNFO0FBQUEsV0FBQSw0Q0FBQTt5QkFBQTtBQUNFLFFBQUEsSUFBQSxHQUFPLElBQUksQ0FBQyxJQUFMLENBQUEsQ0FBUCxDQUFBO0FBQUEsUUFDQSxDQUFBLEdBQUksSUFBSSxDQUFDLE9BQUwsQ0FBYSxHQUFiLENBREosQ0FBQTtBQUVBLFFBQUEsSUFBRyxJQUFLLENBQUEsQ0FBQSxDQUFMLEtBQVcsR0FBWCxJQUFtQixDQUFBLEdBQUksQ0FBMUI7QUFDRSxVQUFBLENBQUEsR0FBSSxFQUFKLENBQUE7QUFDQTtBQUFBLGVBQUEsOENBQUE7MEJBQUE7QUFDRSxZQUFBLENBQUMsQ0FBQyxJQUFGLENBQU8sQ0FBQyxDQUFDLEtBQUYsQ0FBUSxDQUFSLEVBQVcsQ0FBWCxDQUFhLENBQUMsV0FBZCxDQUFBLENBQUEsR0FBOEIsQ0FBQyxDQUFDLEtBQUYsQ0FBUSxDQUFSLENBQVUsQ0FBQyxXQUFYLENBQUEsQ0FBckMsQ0FBQSxDQURGO0FBQUEsV0FEQTtBQUFBLFVBR0EsQ0FBQSxHQUFJLENBQUMsQ0FBQyxJQUFGLENBQU8sRUFBUCxDQUhKLENBQUE7QUFBQSxVQUlBLENBQUEsR0FBSSxJQUFJLENBQUMsS0FBTCxDQUFXLENBQUEsR0FBRSxDQUFiLENBQWUsQ0FBQyxJQUFoQixDQUFBLENBSkosQ0FBQTtBQUFBLFVBS0EsR0FBSSxDQUFBLENBQUEsQ0FBSixHQUFTLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxDQUxULENBREY7U0FIRjtBQUFBLE9BREY7S0FEQTtXQVlBLElBYmM7RUFBQSxDQTdIaEIsQ0FBQTs7QUFBQSxFQTRJQSxRQUFBLEdBQVcsYUFBQSxDQUFBLENBNUlYLENBQUE7O0FBQUEsRUErSUEsR0FBQSxHQUFNLE1BQUEsQ0FBQSxDQS9JTixDQUFBOztBQUFBLEVBa0pBLEdBQUcsQ0FBQyxFQUFKLENBQU8sT0FBUCxFQUFnQixTQUFDLEdBQUQsR0FBQTtBQUNkLElBQUEsSUFBeUMsR0FBRyxDQUFDLElBQUosS0FBWSxRQUFyRDtBQUFBLE1BQUEsS0FBQSxDQUFNLHFCQUFOLEVBQTZCLEdBQTdCLENBQUEsQ0FBQTtLQUFBO1dBQ0EsVUFBQSxDQUFBLEVBRmM7RUFBQSxDQUFoQixDQWxKQSxDQUFBOztBQUFBLEVBc0pBLEdBQUcsQ0FBQyxFQUFKLENBQU8sTUFBUCxFQUFlLFNBQUEsR0FBQTtBQUNiLElBQUEsT0FBTyxDQUFDLEtBQVIsQ0FBYyxtQkFBZCxDQUFBLENBQUE7V0FDQSxPQUFRLENBQUMsSUFBVCxDQUFjLENBQWQsRUFGYTtFQUFBLENBQWYsQ0F0SkEsQ0FBQTs7QUFBQSxFQTBKQSxPQUFPLENBQUMsRUFBUixDQUFXLG1CQUFYLEVBQWdDLFNBQUMsR0FBRCxHQUFBO0FBQzlCLElBQUEsT0FBTyxDQUFDLEtBQVIsQ0FBYyxtQkFBZCxFQUFtQyxHQUFHLENBQUMsS0FBdkMsQ0FBQSxDQUFBO1dBQ0EsR0FBRyxDQUFDLElBQUosQ0FBQSxFQUY4QjtFQUFBLENBQWhDLENBMUpBLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIiMgSmVlQnVzIGRldmVsb3BtZW50IG1vZGU6IGxhdW5jaCBcImdpblwiIGFuZCBjb21waWxlIENTL0phZGUvU3R5bHVzIGFzIG5lZWRlZFxuIyAtamN3LCAyMDE0LTAyLTE5XG5cbmZzID0gcmVxdWlyZSAnZnMnXG5wYXRoID0gcmVxdWlyZSAncGF0aCdcbntleGVjRmlsZSxzcGF3bn0gPSByZXF1aXJlICdjaGlsZF9wcm9jZXNzJ1xuXG4jIGxvb2sgZm9yIG1vZHVsZXMgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgZGlyZWN0b3J5LCBub3QgcmVsYXRpdmUgdG8gdGhpcyBmaWxlXG5tb2R1bGVEaXIgPSAocykgLT4gcGF0aC5yZXNvbHZlICdub2RlX21vZHVsZXMnLCBzXG5cbmNvZmZlZSA9IHJlcXVpcmUgbW9kdWxlRGlyICdjb2ZmZWUtc2NyaXB0J1xuY29udmVydCA9IHJlcXVpcmUgbW9kdWxlRGlyICdjb252ZXJ0LXNvdXJjZS1tYXAnXG5qYWRlID0gcmVxdWlyZSBtb2R1bGVEaXIgJ2phZGUnXG5zdHlsdXMgPSByZXF1aXJlIG1vZHVsZURpciAnc3R5bHVzJ1xuXG5mYXRhbCA9IChzLCBhcmdzLi4uKSAtPlxuICBjb25zb2xlLmVycm9yICdcXG5bbm9kZV0gZmF0YWwgZXJyb3I6Jywgc1xuICBjb25zb2xlLmVycm9yIGFyZ3MuLi4gIGlmIGFyZ3MubGVuZ3RoXG4gIHByb2Nlc3MuZXhpdCAxXG5cbnJ1bkdpbiA9IChkb25lKSAtPlxuICBwID0gc3Bhd24gJ2dpbicsIFtdLCBzdGRpbzogJ3BpcGUnXG4gIHAub24gJ2Nsb3NlJywgKGNvZGUpIC0+XG4gICAgZmF0YWwgJ3VuZXhwZWN0ZWQgdGVybWluYXRpb24gb2YgXCJnaW5cIiwgY29kZTogJyArIGNvZGUgIGlmIGNvZGUgPiAwXG4gIHAuc3Rkb3V0Lm9uICdkYXRhJywgKGRhdGEpIC0+XG4gICAgcyA9IGRhdGEudG9TdHJpbmcoKVxuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlIHMgaWYgZGF0YS5sZW5ndGggPiAwXG4gICAgcmVhZHkoKSAgaWYgL2xpc3RlbmluZyBvbiBwb3J0Ly50ZXN0IHNcbiAgcC5zdGRlcnIub24gJ2RhdGEnLCAoZGF0YSkgLT5cbiAgICBzID0gZGF0YS50b1N0cmluZygpXG4gICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUgcyAgdW5sZXNzIC9leGVjdnBcXChcXCkvLnRlc3Qgc1xuICBwXG4gIFxuaW5zdGFsbEdpbiA9IC0+XG4gIGNvbnNvbGUubG9nICdcImdpblwiIHRvb2wgbm90IGZvdW5kLCBpbnN0YWxsaW5nLi4uJ1xuICBcbiAgIyBhc3N1bWUgXCJnb1wiIGhhcyBiZWVuIGluc3RhbGxlZCBwcm9wZXJseVxuICBleGVjRmlsZSAnZ28nLCBbJ2dldCcsICdnaXRodWIuY29tL2NvZGVnYW5nc3RhL2dpbiddLCAoZXJyLCBzb3V0LCBzZXJyKSAtPlxuICAgIFxuICAgICMgaW5zdGFsbGluZyBcImdvXCIgY2Fubm90IGJlIGRvbmUgYXV0b21hdGljYWxseVxuICAgIGlmIGVyclxuICAgICAgaWYgZXJyLmNvZGUgaXMgJ0VOT0VOVCdcbiAgICAgICAgZmF0YWwgJ1wiZ29cIiBub3QgZm91bmQgLSBwbGVhc2UgaW5zdGFsbCBpdCBmaXJzdCwgc2VlIGh0dHA6Ly9nb2xhbmcub3JnLydcbiAgICAgIGZhdGFsICdpbnN0YWxsIG9mIFwiZ2luXCIgZmFpbGVkJywgc2VyclxuXG4gICAgIyBvaywgdHJ5IHJ1bm5pbmcgXCJnaW5cIiBhZ2FpblxuICAgIGdpbiA9IHJ1bkdpbigpXG4gICAgZ2luLm9uICdlcnJvcicsIChlcnIpIC0+XG4gICAgICBmYXRhbCAnc3RpbGwgY2Fubm90IGxhdW5jaCBcImdpblwiIC0gaXMgJEdPUEFUSC9iaW4gaW4geW91ciAkUEFUSD8nXG4gIFxuY29tcGlsZUNvZmZlZVNjcmlwdFdpdGhNYXAgPSAoc291cmNlQ29kZSwgZmlsZW5hbWUpIC0+XG4gIGNvbXBpbGVkID0gY29mZmVlLmNvbXBpbGUgc291cmNlQ29kZSxcbiAgICBmaWxlbmFtZTogZmlsZW5hbWVcbiAgICBzb3VyY2VNYXA6IHRydWVcbiAgICBpbmxpbmU6IHRydWVcbiAgICBsaXRlcmF0ZTogcGF0aC5leHRuYW1lKGZpbGVuYW1lKSBpc250ICcuY29mZmVlJ1xuICBjb21tZW50ID0gY29udmVydFxuICAgIC5mcm9tSlNPTihjb21waWxlZC52M1NvdXJjZU1hcClcbiAgICAuc2V0UHJvcGVydHkoJ3NvdXJjZXMnLCBbZmlsZW5hbWVdKSBcbiAgICAudG9Db21tZW50KClcbiAgXCIje2NvbXBpbGVkLmpzfVxcbiN7Y29tbWVudH1cXG5cIlxuICBcbmNvbXBpbGVJZk5lZWRlZCA9IChzcmNGaWxlKSAtPlxuICBpZiAvXFwuKGNvZmZlZXxjb2ZmZWVcXC5tZHxsaXRjb2ZmZWV8amFkZXxzdHlsKSQvLnRlc3Qgc3JjRmlsZVxuICAgIHNyY0V4dCA9IHBhdGguZXh0bmFtZSBzcmNGaWxlXG4gICAgc3dpdGNoIHNyY0V4dFxuICAgICAgd2hlbiAnLmphZGUnIHRoZW4gZGVzdEV4dCA9ICcuaHRtbCdcbiAgICAgIHdoZW4gJy5zdHlsJyB0aGVuIGRlc3RFeHQgPSAnLmNzcydcbiAgICAgIGVsc2UgICAgICAgICAgICAgIGRlc3RFeHQgPSAnLmpzJ1xuICAgIGRlc3RGaWxlID0gc3JjRmlsZS5zbGljZSgwLCAtIHNyY0V4dC5sZW5ndGgpICsgZGVzdEV4dFxuICAgIHRyeVxuICAgICAgc3JjU3RhdCA9IGZzLnN0YXRTeW5jIHNyY0ZpbGVcbiAgICAgIGRlc3RTdGF0ID0gZnMuc3RhdFN5bmMgZGVzdEZpbGUgIGlmIGZzLmV4aXN0c1N5bmMgZGVzdEZpbGVcbiAgICAgIHVubGVzcyBkZXN0U3RhdD8ubXRpbWUgPj0gc3JjU3RhdC5tdGltZVxuICAgICAgICBzcmMgPSBmcy5yZWFkRmlsZVN5bmMgc3JjRmlsZSwgZW5jb2Rpbmc6ICd1dGY4J1xuICAgICAgICBzd2l0Y2ggc3JjRXh0XG4gICAgICAgICAgd2hlbiAnLmphZGUnXG4gICAgICAgICAgICBodG1sID0gZG8gamFkZS5jb21waWxlIHNyYywgZmlsZW5hbWU6IHNyY0ZpbGUsIHByZXR0eTogdHJ1ZVxuICAgICAgICAgICAgc2F2ZVJlc3VsdCBkZXN0RmlsZSwgaHRtbFxuICAgICAgICAgIHdoZW4gJy5zdHlsJ1xuICAgICAgICAgICAgc3R5bHVzLnJlbmRlciBzcmMsIHsgZmlsZW5hbWU6IHNyY0ZpbGUgfSwgKGVyciwgY3NzKSAtPlxuICAgICAgICAgICAgICBpZiBlcnJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyAnW25vZGVdIHN0eWx1cyBlcnJvcicsIHNyY0ZpbGUsIGVyclxuICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2F2ZVJlc3VsdCBkZXN0RmlsZSwgY3NzXG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAganMgPSBjb21waWxlQ29mZmVlU2NyaXB0V2l0aE1hcCBzcmMsIHBhdGguYmFzZW5hbWUgc3JjRmlsZVxuICAgICAgICAgICAgc2F2ZVJlc3VsdCBkZXN0RmlsZSwganNcbiAgICBjYXRjaCBlcnJcbiAgICAgIGNvbnNvbGUubG9nICdbbm9kZV0gY2Fubm90IGNvbXBpbGUnLCBzcmNGaWxlLCBlcnJcblxuc2F2ZVJlc3VsdCA9IChmaWxlLCB0ZXh0KSAtPlxuICBjb25zb2xlLmxvZyBcIltub2RlXSBzYXZlZCAje2ZpbGV9ICgje3RleHQubGVuZ3RofWIpXCJcbiAgZnMud3JpdGVGaWxlU3luYyBmaWxlLCB0ZXh0XG5cbnRyYXZlcnNlRGlycyA9IChkaXIsIGNiKSAtPiAjIHJlY3Vyc2l2ZSBkaXJlY3RvcnkgdHJhdmVyc2FsXG4gIHN0YXRzID0gZnMuc3RhdFN5bmMgZGlyXG4gIGlmIHN0YXRzLmlzRGlyZWN0b3J5KClcbiAgICBjYiBkaXJcbiAgICBmb3IgZiBpbiBmcy5yZWFkZGlyU3luYyBkaXJcbiAgICAgIHRyYXZlcnNlRGlycyBwYXRoLmpvaW4oZGlyLCBmKSwgY2Jcblxud2F0Y2hEaXIgPSAocm9vdCwgY2IpIC0+ICMgcmVjdXJzaXZlIGRpcmVjdG9yeSB3YXRjaGVyXG4gIHRyYXZlcnNlRGlycyByb290LCAoZGlyKSAtPlxuICAgIGZzLndhdGNoIGRpciwgKGV2ZW50LCBmaWxlbmFtZSkgLT5cbiAgICAgIGZpbGUgPSBwYXRoLmpvaW4gZGlyLCBmaWxlbmFtZVxuICAgICAgY2IgZXZlbnQsIGZpbGVcblxuY3JlYXRlV2F0Y2hlciA9IChyb290KSAtPlxuICBjb25zb2xlLmxvZyBcIiBcIiwgcm9vdFxuICB0cmF2ZXJzZURpcnMgcm9vdCwgKGRpcikgLT5cbiAgICAjIGNvbnNvbGUubG9nICdkOicsIGRpclxuICAgIGZvciBmIGluIGZzLnJlYWRkaXJTeW5jIGRpclxuICAgICAgY29tcGlsZUlmTmVlZGVkIHBhdGguam9pbiBkaXIsIGZcbiAgICBmcy53YXRjaCBkaXIsIChldmVudCwgZmlsZW5hbWUpIC0+XG4gICAgICBmaWxlID0gcGF0aC5qb2luIGRpciwgZmlsZW5hbWVcbiAgICAgIGlmIGZzLmV4aXN0c1N5bmMgZmlsZVxuICAgICAgICBjb21waWxlSWZOZWVkZWQgZmlsZVxuICAgICAgZWxzZVxuICAgICAgICAjIFRPRE86IGRlbGV0ZSBjb21waWxlZCBmaWxlXG4gIHJvb3RcblxucmVhZHkgPSAtPlxuICBjb25zb2xlLmxvZyAnW25vZGVdIHdhdGNoaW5nIGZvciBmaWxlIGNoYW5nZXMgaW46J1xuICBjcmVhdGVXYXRjaGVyIHNldHRpbmdzLkFwcERpciBvciAnLi9hcHAnXG4gIGNyZWF0ZVdhdGNoZXIgc2V0dGluZ3MuQmFzZURpciBvciAnLi9iYXNlJ1xuICBjcmVhdGVXYXRjaGVyIHNldHRpbmdzLkNvbW1vbkRpciBvciAnLi9jb21tb24nXG5cbnBhcnNlU2V0dGluZ3MgPSAoZm4gPSdzZXR0aW5ncy50eHQnKSAtPlxuICBtYXAgPSB7fVxuICBpZiBmcy5leGlzdHNTeW5jIGZuXG4gICAgZm9yIGxpbmUgaW4gZnMucmVhZEZpbGVTeW5jKGZuLCAndXRmOCcpLnNwbGl0ICdcXG4nXG4gICAgICBsaW5lID0gbGluZS50cmltKClcbiAgICAgIGkgPSBsaW5lLmluZGV4T2YoJz0nKVxuICAgICAgaWYgbGluZVswXSAhPSAnIycgYW5kIGkgPiAwXG4gICAgICAgIHggPSBbXVxuICAgICAgICBmb3IgcyBpbiBsaW5lLnNsaWNlKDAsIGkpLnRyaW0oKS5zcGxpdCAnXydcbiAgICAgICAgICB4LnB1c2ggcy5zbGljZSgwLCAxKS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGsgPSB4LmpvaW4gXCJcIlxuICAgICAgICB2ID0gbGluZS5zbGljZShpKzEpLnRyaW0oKVxuICAgICAgICBtYXBba10gPSBKU09OLnBhcnNlIHZcbiAgbWFwXG5cbnNldHRpbmdzID0gcGFyc2VTZXR0aW5ncygpXG5cbiMgYXNzdW1lIFwiZ29cIiBhbmQgXCJnaW5cIiBoYXZlIGJlZW4gaW5zdGFsbGVkIHByb3Blcmx5XG5naW4gPSBydW5HaW4oKVxuXG4jIGVsc2UsIHRyeSB0byBpbnN0YWxsIFwiZ2luXCIgZmlyc3Rcbmdpbi5vbiAnZXJyb3InLCAoZXJyKSAtPlxuICBmYXRhbCAnY2Fubm90IGxhdW5jaCBcImdpblwiJywgZXJyICB1bmxlc3MgZXJyLmNvZGUgaXMgJ0VOT0VOVCdcbiAgaW5zdGFsbEdpbigpXG4gIFxuZ2luLm9uICdleGl0JywgLT5cbiAgY29uc29sZS5lcnJvciAnW25vZGVdIGdpbiBleGl0ZWQnXG4gIHByb2Nlc3MgLmV4aXQgMVxuXG5wcm9jZXNzLm9uICd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnIpIC0+XG4gIGNvbnNvbGUuZXJyb3IgJ1tub2RlXSBleGNlcHRpb246JywgZXJyLnN0YWNrXG4gIGdpbi5raWxsKClcbiJdfQ==
